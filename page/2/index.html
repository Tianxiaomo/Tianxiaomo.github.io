<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh,en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
































<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="田小默的博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="田小默的博客">
<meta property="og:locale" content="zh,en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="田小默的博客">






  <link rel="canonical" href="http://yoursite.com/page/2/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>田小默的博客</title>
  












  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh,en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">田小默的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/04/Cmake/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="田小默">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="田小默的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/09/04/Cmake/" class="post-title-link" itemprop="url">CMake</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-09-04 19:17:00" itemprop="dateCreated datePublished" datetime="2018-09-04T19:17:00+08:00">2018-09-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-10-16 10:18:14" itemprop="dateModified" datetime="2018-10-16T10:18:14+08:00">2018-10-16</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h2 id="什么是-CMake"><a href="#什么是-CMake" class="headerlink" title="什么是 CMake"></a>什么是 CMake</h2><p>All problems in computer science can be solved by another level of indirection.</p>
<p>David Wheeler</p>
<p>你或许听过好几种 Make 工具，例如 GNU Make ，QT 的 qmake ，微软的 MS nmake，BSD Make（pmake），Makepp，等等。这些 Make 工具遵循着不同的规范和标准，所执行的 Makefile 格式也千差万别。这样就带来了一个严峻的问题：如果软件想跨平台，必须要保证能够在不同平台编译。而如果使用上面的 Make 工具，就得为每一种标准写一次 Makefile ，这将是一件让人抓狂的工作。</p>
<p>CMake就是针对上面问题所设计的工具：它首先允许开发者编写一种平台无关的==CMakeList.txt==文件来定制整个编译流程，然后再根据目标用户的平台进一步生成所需的本地化 Makefile 和工程文件，如 Unix 的 Makefile或Windows的Visual_Studio 工程。从而做到“Write once, run everywhere”。显然，CMake 是一个比上述几种 make 更高级的编译配置工具。一些使用 CMake 作为项目架构系统的知名开源项目有 VTK、ITK、KDE、OpenCV、OSG 等 [1]。</p>
<h3 id="在-linux-平台下使用-CMake-生成-Makefile-并编译的流程如下："><a href="#在-linux-平台下使用-CMake-生成-Makefile-并编译的流程如下：" class="headerlink" title="在 linux 平台下使用 CMake 生成 Makefile 并编译的流程如下："></a>在 linux 平台下使用 CMake 生成 Makefile 并编译的流程如下：</h3><ul>
<li>编写 CMake 配置文件 CMakeLists.txt 。</li>
<li>执行命令 cmake PATH 或者 ccmake PATH 生成 Makefile 11ccmake 和 cmake 的区别在于前者提供了一个交互式的界面。 。其中， PATH 是 CMakeLists.txt 所在的目录。</li>
<li>使用 make 命令进行编译</li>
</ul>
<h2 id="入门案例：单个源文件"><a href="#入门案例：单个源文件" class="headerlink" title="入门案例：单个源文件"></a>入门案例：单个源文件</h2><p>对于简单的项目，只需要写几行代码就可以了。例如，假设现在我们的项目中只有一个源文件 main.cc ，该程序的用途是计算一个数的指数幂。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">/**</span><br><span class="line"> * power - Calculate the power of number.</span><br><span class="line"> * @param base: Base value.</span><br><span class="line"> * @param exponent: Exponent value.</span><br><span class="line"> *</span><br><span class="line"> * @return base raised to the power exponent.</span><br><span class="line"> */</span><br><span class="line">double power(double base, int exponent)</span><br><span class="line">&#123;</span><br><span class="line">    int result = base;</span><br><span class="line">    int i;</span><br><span class="line">    </span><br><span class="line">    if (exponent == 0) &#123;</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    for(i = 1; i &lt; exponent; ++i)&#123;</span><br><span class="line">        result = result * base;</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    if (argc &lt; 3)&#123;</span><br><span class="line">        printf(&quot;Usage: %s base exponent \n&quot;, argv[0]);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    double base = atof(argv[1]);</span><br><span class="line">    int exponent = atoi(argv[2]);</span><br><span class="line">    double result = power(base, exponent);</span><br><span class="line">    printf(&quot;%g ^ %d is %g\n&quot;, base, exponent, result);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="编写-CMakeLists-txt"><a href="#编写-CMakeLists-txt" class="headerlink" title="编写 CMakeLists.txt"></a>编写 CMakeLists.txt</h3><p>首先编写 CMakeLists.txt 文件，并保存在与 main.cc 源文件同个目录下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># CMake 最低版本号要求</span><br><span class="line">cmake_minimum_required (VERSION 2.8)</span><br><span class="line"># 项目信息</span><br><span class="line">project (Demo1)</span><br><span class="line"># 指定生成目标</span><br><span class="line">add_executable(Demo main.cc)</span><br></pre></td></tr></table></figure></p>
<p>CMakeLists.txt 的语法比较简单，由命令、注释和空格组成，其中命令是不区分大小写的。符号 # 后面的内容被认为是注释。命令由命令名称、小括号和参数组成，参数之间使用空格进行间隔。</p>
<p>对于上面的 CMakeLists.txt 文件，依次出现了几个命令：<br>cmake_minimum_required：指定运行此配置文件所需的 CMake 的最低版本；<br>project：参数值是 Demo1，该命令表示项目的名称是 Demo1 。<br>add_executable： 将名为 main.cc 的源文件编译成一个名称为 Demo 的可执行文件。<br>编译项目</p>
<p>之后，在当前目录执行 cmake . ，得到 Makefile 后再使用 make 命令编译得到 Demo1 可执行文件。</p>
<h2 id="多个源文件"><a href="#多个源文件" class="headerlink" title="多个源文件"></a>多个源文件</h2><p>同一目录，多个源文件</p>
<p>上面的例子只有单个源文件。现在假如把 power 函数单独写进一个名为 MathFunctions.c 的源文件里，使得这个工程变成如下的形式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./Demo2</span><br><span class="line">    |</span><br><span class="line">    +--- main.cc</span><br><span class="line">    |</span><br><span class="line">    +--- MathFunctions.cc</span><br><span class="line">    |</span><br><span class="line">    +--- MathFunctions.h</span><br></pre></td></tr></table></figure></p>
<h3 id="CMakeLists-txt"><a href="#CMakeLists-txt" class="headerlink" title="CMakeLists.txt"></a>CMakeLists.txt</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># CMake 最低版本号要求</span><br><span class="line">cmake_minimum_required (VERSION 2.8)</span><br><span class="line"># 项目信息</span><br><span class="line">project (Demo2)</span><br><span class="line"># 指定生成目标</span><br><span class="line">add_executable(Demo main.cc MathFunctions.cc)</span><br></pre></td></tr></table></figure>
<p>更省事的方法是使用 aux_source_directory命令，该命令会查找指定目录下的所有源文件，然后将结果存进指定变量名。其语法如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aux_source_directory(&lt;dir&gt; &lt;variable&gt;)</span><br></pre></td></tr></table></figure></p>
<p>可以修改 CMakeLists.txt 如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># CMake 最低版本号要求</span><br><span class="line">cmake_minimum_required (VERSION 2.8)</span><br><span class="line"># 项目信息</span><br><span class="line">project (Demo2)</span><br><span class="line"># 查找当前目录下的所有源文件</span><br><span class="line"># 并将名称保存到 DIR_SRCS 变量</span><br><span class="line">aux_source_directory(. DIR_SRCS)</span><br><span class="line"># 指定生成目标</span><br><span class="line">add_executable(Demo $&#123;DIR_SRCS&#125;)</span><br></pre></td></tr></table></figure></p>
<p>这样，CMake 会将当前目录所有源文件的文件名赋值给变量 DIR_SRCS ，再指示变量 DIR_SRCS 中的源文件需要编译成一个名称为 Demo 的可执行文件。</p>
<h2 id="多个目录，多个源文件"><a href="#多个目录，多个源文件" class="headerlink" title="多个目录，多个源文件"></a>多个目录，多个源文件</h2><p>现在进一步将 MathFunctions.h 和 MathFunctions.cc 文件移动到 math 目录下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./Demo3</span><br><span class="line">    |</span><br><span class="line">    +--- main.cc</span><br><span class="line">    |</span><br><span class="line">    +--- math/</span><br><span class="line">          |</span><br><span class="line">          +--- MathFunctions.cc</span><br><span class="line">          |</span><br><span class="line">          +--- MathFunctions.h</span><br></pre></td></tr></table></figure></p>
<p>对于这种情况，需要分别在项目根目录 Demo3 和 math 目录里各编写一个 CMakeLists.txt 文件。为了方便，我们可以先将 math 目录里的文件编译成静态库再由 main 函数调用。</p>
<h3 id="根目录中的-CMakeLists-txt-："><a href="#根目录中的-CMakeLists-txt-：" class="headerlink" title="根目录中的 CMakeLists.txt ："></a>根目录中的 CMakeLists.txt ：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># CMake 最低版本号要求</span><br><span class="line">cmake_minimum_required (VERSION 2.8)</span><br><span class="line"># 项目信息</span><br><span class="line">project (Demo3)</span><br><span class="line"># 查找当前目录下的所有源文件</span><br><span class="line"># 并将名称保存到 DIR_SRCS 变量</span><br><span class="line">aux_source_directory(. DIR_SRCS)</span><br><span class="line"># 添加 math 子目录</span><br><span class="line">add_subdirectory(math)</span><br><span class="line"># 指定生成目标 </span><br><span class="line">add_executable(Demo main.cc)</span><br><span class="line"># 添加链接库</span><br><span class="line">target_link_libraries(Demo MathFunctions)</span><br></pre></td></tr></table></figure>
<p>该文件添加了下面的内容: 第3行，使用命令 add_subdirectory 指明本项目包含一个子目录 math，这样 math 目录下的 CMakeLists.txt 文件和源代码也会被处理 。第6行，使用命令 target_link_libraries 指明可执行文件 main 需要连接一个名为 MathFunctions 的链接库 。</p>
<h3 id="子目录中的-CMakeLists-txt："><a href="#子目录中的-CMakeLists-txt：" class="headerlink" title="子目录中的 CMakeLists.txt："></a>子目录中的 CMakeLists.txt：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查找当前目录下的所有源文件</span><br><span class="line"># 并将名称保存到 DIR_LIB_SRCS 变量</span><br><span class="line">aux_source_directory(. DIR_LIB_SRCS)</span><br><span class="line"># 生成链接库</span><br><span class="line">add_library (MathFunctions $&#123;DIR_LIB_SRCS&#125;)</span><br></pre></td></tr></table></figure>
<p>在该文件中使用命令 add_library 将 src 目录中的源文件编译为静态链接库。</p>
<h2 id="自定义编译选项"><a href="#自定义编译选项" class="headerlink" title="自定义编译选项"></a>自定义编译选项</h2><p>CMake 允许为项目增加编译选项，从而可以根据用户的环境和需求选择最合适的编译方案。</p>
<p>例如，可以将 MathFunctions 库设为一个可选的库，如果该选项为 ON ，就使用该库定义的数学函数来进行运算。否则就调用标准库中的数学函数库。</p>
<h3 id="CMakeLists-文件"><a href="#CMakeLists-文件" class="headerlink" title="CMakeLists 文件"></a>CMakeLists 文件</h3><p>我们要做的第一步是在顶层的 CMakeLists.txt 文件中添加该选项：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># CMake 最低版本号要求</span><br><span class="line">cmake_minimum_required (VERSION 2.8)</span><br><span class="line"># 项目信息</span><br><span class="line">project (Demo4)</span><br><span class="line"># 加入一个配置头文件，用于处理 CMake 对源码的设置</span><br><span class="line">configure_file (</span><br><span class="line">  &quot;$&#123;PROJECT_SOURCE_DIR&#125;/config.h.in&quot;</span><br><span class="line">  &quot;$&#123;PROJECT_BINARY_DIR&#125;/config.h&quot;</span><br><span class="line">  )</span><br><span class="line"># 是否使用自己的 MathFunctions 库</span><br><span class="line">option (USE_MYMATH</span><br><span class="line">       &quot;Use provided math implementation&quot; ON)</span><br><span class="line"># 是否加入 MathFunctions 库</span><br><span class="line">if (USE_MYMATH)</span><br><span class="line">  include_directories (&quot;$&#123;PROJECT_SOURCE_DIR&#125;/math&quot;)</span><br><span class="line">  add_subdirectory (math)  </span><br><span class="line">  set (EXTRA_LIBS $&#123;EXTRA_LIBS&#125; MathFunctions)</span><br><span class="line">endif (USE_MYMATH)</span><br><span class="line"># 查找当前目录下的所有源文件</span><br><span class="line"># 并将名称保存到 DIR_SRCS 变量</span><br><span class="line">aux_source_directory(. DIR_SRCS)</span><br><span class="line"># 指定生成目标</span><br><span class="line">add_executable(Demo $&#123;DIR_SRCS&#125;)</span><br><span class="line">target_link_libraries (Demo  $&#123;EXTRA_LIBS&#125;)</span><br></pre></td></tr></table></figure></p>
<p>其中：<br>第7行的 configure_file 命令用于加入一个配置头文件 config.h ，这个文件由 CMake 从 config.h.in 生成，通过这样的机制，将可以通过预定义一些参数和变量来控制代码的生成。<br>第13行的 option 命令添加了一个 USE_MYMATH 选项，并且默认值为 ON 。<br>第17行根据 USE_MYMATH 变量的值来决定是否使用我们自己编写的 MathFunctions 库。<br>修改 main.cc 文件</p>
<p>之后修改 main.cc 文件，让其根据 USE_MYMATH 的预定义值来决定是否调用标准库还是 MathFunctions 库：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#include </span><br><span class="line">#include </span><br><span class="line">#include &quot;config.h&quot;</span><br><span class="line">#ifdef USE_MYMATH</span><br><span class="line">  #include &quot;math/MathFunctions.h&quot;</span><br><span class="line">#else</span><br><span class="line">  #include </span><br><span class="line">#endif</span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    if (argc &lt; 3)&#123;</span><br><span class="line">        printf(&quot;Usage: %s base exponent \n&quot;, argv[0]);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    double base = atof(argv[1]);</span><br><span class="line">    int exponent = atoi(argv[2]);</span><br><span class="line">    </span><br><span class="line">#ifdef USE_MYMATH</span><br><span class="line">    printf(&quot;Now we use our own Math library. \n&quot;);</span><br><span class="line">    double result = power(base, exponent);</span><br><span class="line">#else</span><br><span class="line">    printf(&quot;Now we use the standard library. \n&quot;);</span><br><span class="line">    double result = pow(base, exponent);</span><br><span class="line">#endif</span><br><span class="line">    printf(&quot;%g ^ %d is %g\n&quot;, base, exponent, result);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="编写-config-h-in-文件"><a href="#编写-config-h-in-文件" class="headerlink" title="编写 config.h.in 文件"></a>编写 config.h.in 文件</h3><p>上面的程序值得注意的是第2行，这里引用了一个 config.h 文件，这个文件预定义了 USE_MYMATH 的值。但我们并不直接编写这个文件，为了方便从 CMakeLists.txt 中导入配置，我们编写一个 config.h.in 文件，内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#cmakedefine USE_MYMATH</span><br></pre></td></tr></table></figure></p>
<p>这样 CMake 会自动根据 CMakeLists 配置文件中的设置自动生成 config.h 文件。</p>
<h3 id="编译项目"><a href="#编译项目" class="headerlink" title="编译项目"></a>编译项目</h3><p>现在编译一下这个项目，为了便于交互式的选择该变量的值，可以使用 ccmake 命令 22也可以使用 cmake -i 命令，该命令会提供一个会话式的交互式配置界面。 ：</p>
<p><img src="https://ws1.sinaimg.cn/large/005PF9Rqgy1fuxqwvi9u8j30np0dp789.jpg" alt=""></p>
<p>从中可以找到刚刚定义的 USE_MYMATH 选项，按键盘的方向键可以在不同的选项窗口间跳转，按下 enter 键可以修改该选项。修改完成后可以按下 c 选项完成配置，之后再按 g 键确认生成 Makefile 。ccmake 的其他操作可以参考窗口下方给出的指令提示。</p>
<p>我们可以试试分别将 USE_MYMATH 设为 ON 和 OFF 得到的结果：</p>
<p>USE_MYMATH 为 ON</p>
<p>运行结果：<br>12345 [ehome@xman Demo4]$ ./DemoNow we use our own MathFunctions library.  7 ^ 3 = 343.000000 10 ^ 5 = 100000.000000 2 ^ 10 = 1024.000000<br>此时 config.h 的内容为：<br>1 #define USE_MYMATH<br>USE_MYMATH 为 OFF</p>
<p>运行结果：<br>12345 [ehome@xman Demo4]$ ./DemoNow we use the standard library.  7 ^ 3 = 343.000000 10 ^ 5 = 100000.000000 2 ^ 10 = 1024.000000<br>此时 config.h 的内容为：<br>1 /<em> #undef USE_MYMATH </em>/</p>
<h2 id="安装和测试"><a href="#安装和测试" class="headerlink" title="安装和测试"></a>安装和测试</h2><p>CMake 也可以指定安装规则，以及添加测试。这两个功能分别可以通过在产生 Makefile 后使用 make install 和 make test 来执行。在以前的 GNU Makefile 里，你可能需要为此编写 install 和 test 两个伪目标和相应的规则，但在 CMake 里，这样的工作同样只需要简单的调用几条命令。</p>
<h3 id="定制安装规则"><a href="#定制安装规则" class="headerlink" title="定制安装规则"></a>定制安装规则</h3><p>首先先在 math/CMakeLists.txt 文件里添加下面两行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 指定 MathFunctions 库的安装路径</span><br><span class="line">install (TARGETS MathFunctions DESTINATION bin)</span><br><span class="line">install (FILES MathFunctions.h DESTINATION include)</span><br></pre></td></tr></table></figure></p>
<p>指明 MathFunctions 库的安装路径。之后同样修改根目录的 CMakeLists 文件，在末尾添加下面几行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 指定安装路径install (TARGETS Demo DESTINATION bin)</span><br><span class="line">install (FILES &quot;$&#123;PROJECT_BINARY_DIR&#125;/config.h&quot;         DESTINATION include)</span><br></pre></td></tr></table></figure></p>
<p>通过上面的定制，生成的 Demo 文件和 MathFunctions 函数库 libMathFunctions.o 文件将会被复制到 /usr/local/bin 中，而 MathFunctions.h 和生成的 config.h 文件则会被复制到 /usr/local/include 中。我们可以验证一下33顺带一提的是，这里的 /usr/local/ 是默认安装到的根目录，可以通过修改 CMAKE_INSTALL_PREFIX 变量的值来指定这些文件应该拷贝到哪个根目录。：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[ehome@xman Demo5]$ sudo make install</span><br><span class="line">[ 50%] Built target MathFunctions</span><br><span class="line">[100%] Built target Demo</span><br><span class="line">Install the project...</span><br><span class="line">-- Install configuration: &quot;&quot;</span><br><span class="line">-- Installing: /usr/local/bin/Demo</span><br><span class="line">-- Installing: /usr/local/include/config.h</span><br><span class="line">-- Installing: /usr/local/bin/libMathFunctions.a</span><br><span class="line">-- Up-to-date: /usr/local/include/MathFunctions.h</span><br><span class="line">[ehome@xman Demo5]$ ls /usr/local/bin</span><br><span class="line">Demo  libMathFunctions.a</span><br><span class="line">[ehome@xman Demo5]$ ls /usr/local/include</span><br><span class="line">config.h  MathFunctions.h</span><br></pre></td></tr></table></figure></p>
<h3 id="为工程添加测试"><a href="#为工程添加测试" class="headerlink" title="为工程添加测试"></a>为工程添加测试</h3><p>添加测试同样很简单。CMake 提供了一个称为 CTest 的测试工具。我们要做的只是在项目根目录的 CMakeLists 文件中调用一系列的 add_test 命令。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 启用测试</span><br><span class="line">enable_testing()</span><br><span class="line"># 测试程序是否成功运行</span><br><span class="line">add_test (test_run Demo 5 2)</span><br><span class="line"># 测试帮助信息是否可以正常提示</span><br><span class="line">add_test (test_usage Demo)</span><br><span class="line">set_tests_properties (test_usage</span><br><span class="line">  PROPERTIES PASS_REGULAR_EXPRESSION &quot;Usage: .* base exponent&quot;)</span><br><span class="line"># 测试 5 的平方</span><br><span class="line">add_test (test_5_2 Demo 5 2)</span><br><span class="line">set_tests_properties (test_5_2</span><br><span class="line"> PROPERTIES PASS_REGULAR_EXPRESSION &quot;is 25&quot;)</span><br><span class="line"># 测试 10 的 5 次方</span><br><span class="line">add_test (test_10_5 Demo 10 5)</span><br><span class="line">set_tests_properties (test_10_5</span><br><span class="line"> PROPERTIES PASS_REGULAR_EXPRESSION &quot;is 100000&quot;)</span><br><span class="line"># 测试 2 的 10 次方</span><br><span class="line">add_test (test_2_10 Demo 2 10)</span><br><span class="line">set_tests_properties (test_2_10</span><br><span class="line"> PROPERTIES PASS_REGULAR_EXPRESSION &quot;is 1024&quot;)</span><br></pre></td></tr></table></figure></p>
<p>用来测试输出是否包含后面跟着的字符串。</p>
<p>让我们看看测试的结果：<br>123456789101112131415 [ehome@xman Demo5]$ make testRunning tests…Test project /home/ehome/Documents/programming/C/power/Demo5    Start 1: test_run1/4 Test #1: test_run …………………….   Passed    0.00 sec    Start 2: test_5_22/4 Test #2: test_5_2 …………………….   Passed    0.00 sec    Start 3: test_10_53/4 Test #3: test_10_5 ……………………   Passed    0.00 sec    Start 4: test_2_104/4 Test #4: test_2_10 ……………………   Passed    0.00 sec100% tests passed, 0 tests failed out of 4Total Test time (real) =   0.01 sec<br>如果要测试更多的输入数据，像上面那样一个个写测试用例未免太繁琐。这时可以通过编写宏来实现：<br>1234567891011 # 定义一个宏，用来简化测试工作macro (do_test arg1 arg2 result)add_test (test_${arg1}_${arg2} Demo ${arg1}${arg2})set_tests_properties (test_${arg1}_${arg2}    PROPERTIES PASS_REGULAR_EXPRESSION ${result})endmacro (do_test)# 使用该宏进行一系列的数据测试do_test (52”is 25”)do_test (105”is 100000”)do_test (210”is 1024”)<br>关于 CTest 的更详细的用法可以通过 man 1 ctest 参考 CTest 的文档。</p>
<h2 id="支持-gdb"><a href="#支持-gdb" class="headerlink" title="支持 gdb"></a>支持 gdb</h2><p>让 CMake 支持 gdb 的设置也很容易，只需要指定 Debug 模式下开启 -g 选项：<br>123 set(CMAKE_BUILD_TYPE “Debug”)set(CMAKE_CXX_FLAGS_DEBUG “$ENV{CXXFLAGS} -O0 -Wall -g -ggdb”)set(CMAKE_CXX_FLAGS_RELEASE “$ENV{CXXFLAGS} -O3 -Wall”)<br>之后可以直接对生成的程序使用 gdb 来调试。</p>
<p>添加环境检查</p>
<p>本节对应的源代码所在目录：Demo6。</p>
<p>有时候可能要对系统环境做点检查，例如要使用一个平台相关的特性的时候。在这个例子中，我们检查系统是否自带 pow 函数。如果带有 pow 函数，就使用它；否则使用我们定义的 power 函数。</p>
<p>添加 CheckFunctionExists 宏</p>
<p>首先在顶层 CMakeLists 文件中添加 CheckFunctionExists.cmake 宏，并调用 check_function_exists 命令测试链接器是否能够在链接阶段找到 pow 函数。<br>123 # 检查系统是否支持 pow 函数include (${CMAKE_ROOT}/Modules/CheckFunctionExists.cmake)check_function_exists (pow HAVE_POW)<br>将上面这段代码放在 configure_file 命令前。</p>
<p>预定义相关宏变量</p>
<p>接下来修改 config.h.in 文件，预定义相关的宏变量。<br>12 // does the platform provide pow function?#cmakedefine HAVE_POW<br>在代码中使用宏和函数</p>
<p>最后一步是修改 main.cc ，在代码中使用宏和函数：<br>1234567 #ifdef HAVE_POW    printf(“Now we use the standard library. \n”);    double result = pow(base, exponent);#else    printf(“Now we use our own Math library. \n”);    double result = power(base, exponent);#endif</p>
<h3 id="添加版本号"><a href="#添加版本号" class="headerlink" title="添加版本号"></a>添加版本号</h3><p>给项目添加和维护版本号是一个好习惯，这样有利于用户了解每个版本的维护情况，并及时了解当前所用的版本是否过时，或是否可能出现不兼容的情况。</p>
<p>首先修改顶层 CMakeLists 文件，在 project 命令之后加入如下两行：<br>12 set (Demo_VERSION_MAJOR 1)set (Demo_VERSION_MINOR 0)<br>分别指定当前的项目的主版本号和副版本号。</p>
<p>之后，为了在代码中获取版本信息，我们可以修改 config.h.in 文件，添加两个预定义变量：<br>123 // the configured options and settings for Tutorial#define Demo_VERSION_MAJOR @Demo_VERSION_MAJOR@#define Demo_VERSION_MINOR @Demo_VERSION_MINOR@<br>这样就可以直接在代码中打印版本信息了：<br>12345678910111213141516171819202122232425262728293031 #include #include #include #include “config.h”#include “math/MathFunctions.h”int main(int argc, char *argv[]){if (argc &lt; 3){// print version infoprintf(“%s Version %d.%d\n”,            argv[0],            Demo_VERSION_MAJOR,            Demo_VERSION_MINOR);printf(“Usage: %s base exponent \n”, argv[0]);return1;    }double base = atof(argv[1]);int exponent = atoi(argv[2]);#if defined (HAVE_POW)printf(“Now we use the standard library. \n”);double result = pow(base, exponent);#elseprintf(“Now we use our own Math library. \n”);double result = power(base, exponent);#endifprintf(“%g ^ %d is %g\n”, base, exponent, result);return0;}</p>
<h2 id="生成安装包"><a href="#生成安装包" class="headerlink" title="生成安装包"></a>生成安装包</h2><p>本节将学习如何配置生成各种平台上的安装包，包括二进制安装包和源码安装包。为了完成这个任务，我们需要用到 CPack ，它同样也是由 CMake 提供的一个工具，专门用于打包。</p>
<p>首先在顶层的 CMakeLists.txt 文件尾部添加下面几行：<br>1234567 # 构建一个 CPack 安装包include (InstallRequiredSystemLibraries)set (CPACK_RESOURCE_FILE_LICENSE  “${CMAKE_CURRENT_SOURCE_DIR}/License.txt”)set (CPACK_PACKAGE_VERSION_MAJOR “${Demo_VERSION_MAJOR}”)set (CPACK_PACKAGE_VERSION_MINOR “${Demo_VERSION_MINOR}”)include (CPack)<br>上面的代码做了以下几个工作：<br>导入 InstallRequiredSystemLibraries 模块，以便之后导入 CPack 模块；<br>设置一些 CPack 相关变量，包括版权信息和版本信息，其中版本信息用了上一节定义的版本号；<br>导入 CPack 模块。<br>接下来的工作是像往常一样构建工程，并执行 cpack 命令。<br>生成二进制安装包：<br>1 cpack -C CPackConfig.cmake<br>生成源码安装包<br>1 cpack -C CPackSourceConfig.cmake<br>我们可以试一下。在生成项目后，执行 cpack -C CPackConfig.cmake 命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[ehome@xman Demo8]$ cpack -C CPackSourceConfig.cmake</span><br><span class="line">CPack: Create package using STGZ</span><br><span class="line">CPack: Install projects</span><br><span class="line">CPack: - Run preinstall target for: Demo8</span><br><span class="line">CPack: - Install project: Demo8</span><br><span class="line">CPack: Create package</span><br><span class="line">CPack: - package: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux.sh generated.</span><br><span class="line">CPack: Create package using TGZ</span><br><span class="line">CPack: Install projects</span><br><span class="line">CPack: - Run preinstall target for: Demo8</span><br><span class="line">CPack: - Install project: Demo8</span><br><span class="line">CPack: Create package</span><br><span class="line">CPack: - package: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux.tar.gz generated.</span><br><span class="line">CPack: Create package using TZ</span><br><span class="line">CPack: Install projects</span><br><span class="line">CPack: - Run preinstall target for: Demo8</span><br><span class="line">CPack: - Install project: Demo8</span><br><span class="line">CPack: Create package</span><br><span class="line">CPack: - package: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux.tar.Z generated.</span><br></pre></td></tr></table></figure></p>
<p>此时会在该目录下创建 3 个不同格式的二进制包文件：<br>12 [ehome@xman Demo8]$ ls Demo8-*Demo8-1.0.1-Linux.sh  Demo8-1.0.1-Linux.tar.gz  Demo8-1.0.1-Linux.tar.Z<br>这 3 个二进制包文件所包含的内容是完全相同的。我们可以执行其中一个。此时会出现一个由 CPack 自动生成的交互式安装界面：</p>
<p>完成后提示安装到了 Demo8-1.0.1-Linux 子目录中，我们可以进去执行该程序：<br>123 [ehome@xman Demo8]$ ./Demo8-1.0.1-Linux/bin/Demo 52Now we use our own Math library. 5 ^ 2 is 25<br>关于 CPack 的更详细的用法可以通过 man 1 cpack 参考 CPack 的文档。</p>
<h2 id="将其他平台的项目迁移到-CMake"><a href="#将其他平台的项目迁移到-CMake" class="headerlink" title="将其他平台的项目迁移到 CMake"></a>将其他平台的项目迁移到 CMake</h2><p>CMake 可以很轻松地构建出在适合各个平台执行的工程环境。而如果当前的工程环境不是 CMake ，而是基于某个特定的平台，是否可以迁移到 CMake 呢？答案是可能的。下面针对几个常用的平台，列出了它们对应的迁移方案。</p>
<p>autotools<br>am2cmake 可以将 autotools 系的项目转换到 CMake，这个工具的一个成功案例是 KDE 。<br>Alternative Automake2CMake 可以转换使用 automake 的 KDevelop 工程项目。<br>Converting autoconf tests<br>qmake<br>qmake converter 可以转换使用 QT 的 qmake 的工程。<br>Visual Studio<br>vcproj2cmake.rb 可以根据 Visual Studio 的工程文件（后缀名是 .vcproj 或 .vcxproj）生成 CMakeLists.txt 文件。<br>vcproj2cmake.ps1 vcproj2cmake 的 PowerShell 版本。<br>folders4cmake 根据 Visual Studio 项目文件生成相应的 “source_group” 信息，这些信息可以很方便的在 CMake 脚本中使用。支持 Visual Studio 9/10 工程文件。<br>CMakeLists.txt 自动推导<br>gencmake 根据现有文件推导 CMakeLists.txt 文件。<br>CMakeListGenerator 应用一套文件和目录分析创建出完整的 CMakeLists.txt 文件。仅支持 Win32 平台。</p>
<h2 id="加入第三方库"><a href="#加入第三方库" class="headerlink" title="加入第三方库"></a>加入第三方库</h2><p>CMake构建工程的时候很多程序可以使用写好的库，这就会涉及到库的编译链接过程。这里使用的提到的 Ubuntu下libxml2的安装和使用xml库作为讲解示例，如何安转运行请点击链接。</p>
<p>CMakeLists.txt文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">CMAKE_MINIMUM_REQUIRED(VERSION 2.8)</span><br><span class="line">PROJECT(seglink)</span><br><span class="line"></span><br><span class="line"># compiler flags</span><br><span class="line">SET(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++11 $&#123;OpenMP_CXX_FLAGS&#125; -Wall -fPIC -D_GLIBCXX_USE_CXX11_ABI=0&quot;)</span><br><span class="line"></span><br><span class="line"># TensorFlow dependencies</span><br><span class="line">EXECUTE_PROCESS(COMMAND python3 -c &quot;import os; os.environ[&apos;TF_CPP_MIN_LOG_LEVEL&apos;]=&apos;3&apos;; import tensorflow as tf; print(tf.sysconfig.get_include())&quot;</span><br><span class="line">                OUTPUT_VARIABLE TF_INC)</span><br><span class="line">MESSAGE(STATUS &quot;Found TF_INC: &quot; $&#123;TF_INC&#125;)</span><br><span class="line"></span><br><span class="line">#MESSAGE( STATUS &quot;this var key = $&#123;USER_KEY&#125;.&quot;)</span><br><span class="line"># boost</span><br><span class="line"></span><br><span class="line"># target</span><br><span class="line">INCLUDE_DIRECTORIES($&#123;TF_INC&#125;)</span><br><span class="line">ADD_LIBRARY(seglink SHARED </span><br><span class="line">  utilities.h</span><br><span class="line">  sample_crop_bbox_op.cc</span><br><span class="line">  encode_groundtruth_op.cc</span><br><span class="line">  decode_segments_links_op.cc</span><br><span class="line">  combine_segments_op.cc</span><br><span class="line">  detection_mask_op.cc</span><br><span class="line">  clip_rboxes_op.cc</span><br><span class="line">  polygons_to_rboxes_op.cc</span><br><span class="line">  project_polygons_op.cc)</span><br></pre></td></tr></table></figure></p>
<h3 id="编译错误信息"><a href="#编译错误信息" class="headerlink" title="编译错误信息"></a>编译错误信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(dl) amax@amax36:~/HGH/seglink$ python ./manage.py build_op</span><br><span class="line">[ 11%] Building CXX object CMakeFiles/seglink.dir/sample_crop_bbox_op.cc.o</span><br><span class="line">[ 22%] Building CXX object CMakeFiles/seglink.dir/detection_mask_op.cc.o</span><br><span class="line">[ 33%] Building CXX object CMakeFiles/seglink.dir/decode_segments_links_op.cc.o</span><br><span class="line">[ 44%] Building CXX object CMakeFiles/seglink.dir/encode_groundtruth_op.cc.o</span><br><span class="line">[ 55%] Building CXX object CMakeFiles/seglink.dir/combine_segments_op.cc.o</span><br><span class="line">[ 66%] Building CXX object CMakeFiles/seglink.dir/project_polygons_op.cc.o</span><br><span class="line">[ 77%] Building CXX object CMakeFiles/seglink.dir/clip_rboxes_op.cc.o</span><br><span class="line">[ 88%] Building CXX object CMakeFiles/seglink.dir/polygons_to_rboxes_op.cc.o</span><br><span class="line">In file included from /home/amax/anaconda3/envs/dl/lib/python3.6/site-packages/tensorflow/include/tensorflow/core/platform/mutex.h:31:0,</span><br><span class="line">                 from /home/amax/anaconda3/envs/dl/lib/python3.6/site-packages/tensorflow/include/tensorflow/core/framework/variant.h:31,</span><br><span class="line">                 from /home/amax/anaconda3/envs/dl/lib/python3.6/site-packages/tensorflow/include/tensorflow/core/framework/allocator.h:26,</span><br><span class="line">                 from /home/amax/anaconda3/envs/dl/lib/python3.6/site-packages/tensorflow/include/tensorflow/core/framework/op_kernel.h:23,</span><br><span class="line">                 from /home/amax/HGH/seglink/seglink/cpp/combine_segments_op.cc:10:</span><br><span class="line">/home/amax/anaconda3/envs/dl/lib/python3.6/site-packages/tensorflow/include/tensorflow/core/platform/default/mutex.h:25:22: fatal error: nsync_cv.h: 没有那个文件或目录</span><br><span class="line">compilation terminated.</span><br><span class="line">CMakeFiles/seglink.dir/build.make:62: recipe for target &apos;CMakeFiles/seglink.dir/sample_crop_bbox_op.cc.o&apos; failed</span><br><span class="line">make[2]: *** [CMakeFiles/seglink.dir/sample_crop_bbox_op.cc.o] Error 1</span><br><span class="line">CMakeFiles/Makefile2:67: recipe for target &apos;CMakeFiles/seglink.dir/all&apos; failed</span><br><span class="line">make[1]: *** [CMakeFiles/seglink.dir/all] Error 2</span><br><span class="line">Makefile:83: recipe for target &apos;all&apos; failed</span><br><span class="line">make: *** [all] Error 2</span><br><span class="line">cp: 无法获取&apos;libseglink.so&apos; 的文件状态(stat): 没有那个文件或目录</span><br><span class="line">Building complete</span><br></pre></td></tr></table></figure>
<p>找不到头文件，因此需要修改CMakeLists.txt让让编译系统找到头文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">CMAKE_MINIMUM_REQUIRED(VERSION 2.8)</span><br><span class="line">PROJECT(seglink)</span><br><span class="line"></span><br><span class="line"># compiler flags</span><br><span class="line">SET(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++11 $&#123;OpenMP_CXX_FLAGS&#125; -Wall -fPIC -D_GLIBCXX_USE_CXX11_ABI=0&quot;)</span><br><span class="line"></span><br><span class="line"># TensorFlow dependencies</span><br><span class="line">EXECUTE_PROCESS(COMMAND python3 -c &quot;import os; os.environ[&apos;TF_CPP_MIN_LOG_LEVEL&apos;]=&apos;3&apos;; import tensorflow as tf; print(tf.sysconfig.get_include())&quot;</span><br><span class="line">                OUTPUT_VARIABLE TF_INC)</span><br><span class="line">MESSAGE(STATUS &quot;Found TF_INC: &quot; $&#123;TF_INC&#125;)</span><br><span class="line"></span><br><span class="line">#MESSAGE( STATUS &quot;this var key = $&#123;USER_KEY&#125;.&quot;)</span><br><span class="line"># boost</span><br><span class="line"></span><br><span class="line">include_directories(/home/amax/anaconda3/envs/dl/lib/python3.6/site-packages/tensorflow/include/external/nsync/public)</span><br><span class="line"></span><br><span class="line"># target</span><br><span class="line">INCLUDE_DIRECTORIES($&#123;TF_INC&#125;)</span><br><span class="line">ADD_LIBRARY(seglink SHARED </span><br><span class="line">  utilities.h</span><br><span class="line">  sample_crop_bbox_op.cc</span><br><span class="line">  encode_groundtruth_op.cc</span><br><span class="line">  decode_segments_links_op.cc</span><br><span class="line">  combine_segments_op.cc</span><br><span class="line">  detection_mask_op.cc</span><br><span class="line">  clip_rboxes_op.cc</span><br><span class="line">  polygons_to_rboxes_op.cc</span><br><span class="line">  project_polygons_op.cc)</span><br></pre></td></tr></table></figure></p>
<p>修改称上面的样子再进行编译，成功。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/04/cython-setup-py修改/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="田小默">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="田小默的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/09/04/cython-setup-py修改/" class="post-title-link" itemprop="url">cython-setup.py修改</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-09-04 10:22:01" itemprop="dateCreated datePublished" datetime="2018-09-04T10:22:01+08:00">2018-09-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-10-16 10:38:41" itemprop="dateModified" datetime="2018-10-16T10:38:41+08:00">2018-10-16</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>源码为linux系统的，在windows运行出现问题,找不到相关文件 bbox，查看</p>
<p><img src="https://ws1.sinaimg.cn/large/005PF9Rqgy1fuo9lv03dcj30750cat8w.jpg" alt=""></p>
<p>发现是由cython编写的，生成的文件为.so格式，在windows下自然用不了。</p>
<p>修改setup文件，生成windows文件.pyd。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">#原文件</span><br><span class="line">from Cython.Build import cythonize</span><br><span class="line">import os</span><br><span class="line">from os.path import join as pjoin</span><br><span class="line">import numpy as np</span><br><span class="line">from distutils.core import setup</span><br><span class="line">from distutils.extension import Extension</span><br><span class="line">from Cython.Distutils import build_ext</span><br><span class="line"></span><br><span class="line">def find_in_path(name, path):</span><br><span class="line">    for dir in path.split(os.pathsep):</span><br><span class="line">        binpath = pjoin(dir, name)</span><br><span class="line">        if os.path.exists(binpath):</span><br><span class="line">            return os.path.abspath(binpath)</span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line">def locate_cuda():</span><br><span class="line">    # first check if the CUDAHOME env variable is in use</span><br><span class="line">    if &apos;CUDAHOME&apos; in os.environ:</span><br><span class="line">        home = os.environ[&apos;CUDAHOME&apos;]</span><br><span class="line">        nvcc = pjoin(home, &apos;bin&apos;, &apos;nvcc&apos;)</span><br><span class="line">    else:</span><br><span class="line">        # otherwise, search the PATH for NVCC</span><br><span class="line">        default_path = pjoin(os.sep, &apos;usr&apos;, &apos;local&apos;, &apos;cuda&apos;, &apos;bin&apos;)</span><br><span class="line">        nvcc = find_in_path(&apos;nvcc&apos;, os.environ[&apos;PATH&apos;] + os.pathsep + default_path)</span><br><span class="line">        if nvcc is None:</span><br><span class="line">            raise EnvironmentError(&apos;The nvcc binary could not be &apos;</span><br><span class="line">                &apos;located in your $PATH. Either add it to your path, or set $CUDAHOME&apos;)</span><br><span class="line">        home = os.path.dirname(os.path.dirname(nvcc))</span><br><span class="line"></span><br><span class="line">    cudaconfig = &#123;&apos;home&apos;:home, &apos;nvcc&apos;:nvcc,</span><br><span class="line">                  &apos;include&apos;: pjoin(home, &apos;include&apos;),</span><br><span class="line">                  &apos;lib64&apos;: pjoin(home, &apos;lib64&apos;)&#125;</span><br><span class="line">    for k, v in cudaconfig.items():</span><br><span class="line">    #for k, v in cudaconfig.iteritems():</span><br><span class="line">        if not os.path.exists(v):</span><br><span class="line">            raise EnvironmentError(&apos;The CUDA %s path could not be located in %s&apos; % (k, v))</span><br><span class="line">    return cudaconfig</span><br><span class="line"></span><br><span class="line">CUDA = locate_cuda()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    numpy_include = np.get_include()</span><br><span class="line">except AttributeError:</span><br><span class="line">    numpy_include = np.get_numpy_include()</span><br><span class="line"></span><br><span class="line">def customize_compiler_for_nvcc(self):</span><br><span class="line">    self.src_extensions.append(&apos;.cu&apos;)</span><br><span class="line">    default_compiler_so = self.compiler_so</span><br><span class="line">    super = self._compile</span><br><span class="line">    def _compile(obj, src, ext, cc_args, extra_postargs, pp_opts):</span><br><span class="line">        print(extra_postargs)</span><br><span class="line">        if os.path.splitext(src)[1] == &apos;.cu&apos;:</span><br><span class="line">            # use the cuda for .cu files</span><br><span class="line">            self.set_executable(&apos;compiler_so&apos;, CUDA[&apos;nvcc&apos;])</span><br><span class="line">            # use only a subset of the extra_postargs, which are 1-1 translated</span><br><span class="line">            # from the extra_compile_args in the Extension class</span><br><span class="line">            postargs = extra_postargs[&apos;nvcc&apos;]</span><br><span class="line">        else:</span><br><span class="line">            postargs = extra_postargs[&apos;gcc&apos;]</span><br><span class="line"></span><br><span class="line">        super(obj, src, ext, cc_args, postargs, pp_opts)</span><br><span class="line">        # reset the default compiler_so, which we might have changed for cuda</span><br><span class="line">        self.compiler_so = default_compiler_so</span><br><span class="line">    # inject our redefined _compile method into the class</span><br><span class="line">    self._compile = _compile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># run the customize_compiler</span><br><span class="line">class custom_build_ext(build_ext):</span><br><span class="line">    def build_extensions(self):</span><br><span class="line">        customize_compiler_for_nvcc(self.compiler)</span><br><span class="line">        build_ext.build_extensions(self)</span><br><span class="line"></span><br><span class="line">ext_modules = [</span><br><span class="line">    Extension(</span><br><span class="line">        &quot;utils.bbox&quot;,</span><br><span class="line">        [&quot;bbox.pyx&quot;],</span><br><span class="line">        extra_compile_args=&#123;&apos;gcc&apos;: [&quot;-Wno-cpp&quot;, &quot;-Wno-unused-function&quot;]&#125;,</span><br><span class="line">        include_dirs = [numpy_include]</span><br><span class="line">    ),</span><br><span class="line">    Extension(</span><br><span class="line">        &quot;utils.cython_nms&quot;,</span><br><span class="line">        [&quot;cython_nms.pyx&quot;],</span><br><span class="line">        extra_compile_args=&#123;&apos;gcc&apos;: [&quot;-Wno-cpp&quot;, &quot;-Wno-unused-function&quot;]&#125;,</span><br><span class="line">        include_dirs = [numpy_include]</span><br><span class="line">    ),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    ext_modules=ext_modules,</span><br><span class="line">    cmdclass=&#123;&apos;build_ext&apos;: custom_build_ext&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>直接运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python .\setup_cpu.py build_ext --inplace</span><br></pre></td></tr></table></figure></p>
<p>出现错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">File &quot;setup_cpu.py&quot;, line 50, in customize_compiler_for_nvcc</span><br><span class="line">default_compiler_so = self.compiler_so</span><br><span class="line">AttributeError: &apos;MSVCCompiler&apos; object has no attribute &apos;compiler_so&apos;</span><br></pre></td></tr></table></figure></p>
<p>这里自定义的编译器为linux的gcc，需要修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">from Cython.Build import cythonize</span><br><span class="line">import os</span><br><span class="line">from os.path import join as pjoin</span><br><span class="line">import numpy as np</span><br><span class="line">from distutils.core import setup</span><br><span class="line">from distutils.extension import Extension</span><br><span class="line">from Cython.Distutils import build_ext</span><br><span class="line"></span><br><span class="line">def find_in_path(name, path):</span><br><span class="line">    for dir in path.split(os.pathsep):</span><br><span class="line">        binpath = pjoin(dir, name)</span><br><span class="line">        if os.path.exists(binpath):</span><br><span class="line">            return os.path.abspath(binpath)</span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    numpy_include = np.get_include()</span><br><span class="line">except AttributeError:</span><br><span class="line">    numpy_include = np.get_numpy_include()</span><br><span class="line"></span><br><span class="line"># run the customize_compiler</span><br><span class="line">class custom_build_ext(build_ext):</span><br><span class="line">    def build_extensions(self):</span><br><span class="line">        self.compiler.src_extensions.append(&apos;.cu&apos;)</span><br><span class="line">        self.compiler.set_executable(&apos;compiler_so&apos;, &apos;nvcc&apos;)</span><br><span class="line">        self.compiler.set_executable(&apos;linker_so&apos;, &apos;nvcc --shared&apos;)</span><br><span class="line">        if hasattr(self.compiler, &apos;_c_extensions&apos;):</span><br><span class="line">            self.compiler._c_extensions.append(&apos;.cu&apos;)  # needed for Windows</span><br><span class="line">        self.compiler.spawn = self.spawn</span><br><span class="line">        build_ext.build_extensions(self)</span><br><span class="line"></span><br><span class="line">ext_modules = [</span><br><span class="line">               Extension(</span><br><span class="line">                         &quot;utils.bbox&quot;,</span><br><span class="line">                         [&quot;bbox.pyx&quot;],</span><br><span class="line">                        extra_compile_args=[&apos;-Wno-cpp&apos;, &apos;-Wno-unused-function&apos;, &apos;-std=c99&apos;],</span><br><span class="line">                         include_dirs = [numpy_include]</span><br><span class="line">                         ),</span><br><span class="line">               Extension(</span><br><span class="line">                         &quot;utils.cython_nms&quot;,</span><br><span class="line">                         [&quot;cython_nms.pyx&quot;],</span><br><span class="line">                        extra_compile_args=[&apos;-Wno-cpp&apos;, &apos;-Wno-unused-function&apos;, &apos;-std=c99&apos;],</span><br><span class="line">                         include_dirs = [numpy_include]</span><br><span class="line">                         ),]</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    ext_modules=ext_modules,</span><br><span class="line">    cmdclass=&#123;&apos;build_ext&apos;: custom_build_ext&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>运行生成build和utile文件夹，将utile中的.pyd文件拷贝出来，删除两个文件夹</p>
<p><img src="https://ws1.sinaimg.cn/large/005PF9Rqgy1fuo9ktuvsxj308c0dnjrp.jpg" alt=""></p>
<p><a href="https://blog.csdn.net/chenzhi1992/article/details/53374265" target="_blank" rel="noopener"><strong>参考博客</strong></a></p>
<p><a href="http://docs.cython.org/en/latest/src/userguide/source_files_and_compilation.html" target="_blank" rel="noopener"><strong>cython源文件和编译</strong></a></p>
<p><a href="https://moonlet.gitbooks.io/cython-document-zh_cn/content/ch1-basic_tutorial.html" target="_blank" rel="noopener"><strong>cython官方文档</strong></a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/01/文本检测识别算法/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="田小默">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="田小默的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/09/01/文本检测识别算法/" class="post-title-link" itemprop="url">文本检测识别算法</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-09-01 13:43:08" itemprop="dateCreated datePublished" datetime="2018-09-01T13:43:08+08:00">2018-09-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-23 18:38:48" itemprop="dateModified" datetime="2018-12-23T18:38:48+08:00">2018-12-23</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1 id="CTPN-Connectionist-Text-Proposal-Network"><a href="#CTPN-Connectionist-Text-Proposal-Network" class="headerlink" title="CTPN(Connectionist Text Proposal Network)"></a>CTPN(Connectionist Text Proposal Network)</h1><ul>
<li><a href="https://arxiv.org/pdf/1609.03605.pdf" target="_blank" rel="noopener">论文</a></li>
<li><a href="https://github.com/Tianxiaomo/chinese-ocr" target="_blank" rel="noopener">代码</a></li>
</ul>
<h2 id="idea"><a href="#idea" class="headerlink" title="idea"></a>idea</h2><ul>
<li><p>文本检测和一般目标检测的不同——文本线是一个sequence（字符、字符的一部分、多字符组成的一个sequence），而不是一般目标检测中只有一个独立的目标。这既是优势，也是难点。优势体现在同一文本线上不同字符可以互相利用上下文，可以用sequence的方法比如RNN来表示。难点体现在要检测出一个完整的文本线，同一文本线上不同字符可能差异大，距离远，要作为一个整体检测出来难度比单个目标更大——因此，作者认为预测文本的竖直位置（文本bounding box的上下边界）比水平位置（文本bounding box的左右边界）更容易。</p>
</li>
<li><p>Top-down（先检测文本区域，再找出文本线）的文本检测方法比传统的bottom-up的检测方法（先检测字符，再串成文本线）更好。自底向上的方法的缺点在于（这点在作者的另一篇文章中说的更清楚），总结起来就是没有考虑上下文，不够鲁棒，系统需要太多子模块，太复杂且误差逐步积累，性能受限。</p>
</li>
<li><p>RNN和CNN的无缝结合可以提高检测精度。CNN用来提取深度特征，RNN用来序列的特征识别（2类），二者无缝结合，用在检测上性能更好。</p>
</li>
</ul>
<h2 id="pipeline"><a href="#pipeline" class="headerlink" title="pipeline"></a>pipeline</h2><p><img src="https://ws1.sinaimg.cn/large/005PF9Rqgy1futz0f6m9qj319m0du11c.jpg" alt="image"></p>
<ol>
<li>VGG16的前5个conv stage(conv5_3)作为base net得到 feature map(W<em> H </em>C)</li>
<li>在Conv5的feature map的每个位置上取3<em> 3 </em>C的窗口的特征，这些特征将用于预测该位置k个anchor（anchor的定义和Faster RCNN类似）对应的类别信息，位置信息。这个特征向量将用来预测和10个anchor之间的偏移距离，也就是说每一个窗口中心都会预测出10个text propsoal。</li>
<li>将每一行的所有窗口对应的3<em>3</em>C的特征（W<em>3</em>3<em>C）输入到RNN（BLSTM）中，得到W</em>256的输出</li>
<li>将RNN的W*256输入到512维的fc层</li>
<li>fc层特征输入到三个分类或者回归层中。第二个2k scores 表示的是k个anchor的类别信息（是字符或不是字符）。第一个2k vertical coordinate和第三个k side-refinement是用来回归k个anchor的位置信息。2k vertical coordinate表示的是bounding box的高度和中心的y轴坐标（可以决定上下边界），k个side-refinement表示的bounding box的水平平移量。这边注意，只用了3个参数表示回归的bounding box，因为这里默认了每个anchor的width是16，且不再变化（VGG16的conv5的stride是16）。回归出来的box如Fig.1中那些红色的细长矩形，它们的宽度是一定的。</li>
<li>用简单的文本线构造算法，把分类得到的文字的proposal（图Fig.1（b）中的细长的矩形）合并成文本线</li>
</ol>
<h2 id="细节"><a href="#细节" class="headerlink" title="细节"></a>细节</h2><ul>
<li>conv5的featuremap作为输入入，宽度恰好被固定为16个像素。只用来预测纵轴y即可。</li>
</ul>
<p><img src="https://ws1.sinaimg.cn/large/005PF9Rqgy1fuu21ae8bnj30rk06baax.jpg" alt="image"></p>
<p>c anchor中心，h anchor高度，a 是预测，*是实际，h是提议的高度</p>
<ul>
<li>score阈值设置：0.7 （+NMS）</li>
<li>Recurrent Connectionist Text Proposals<ul>
<li>RNN类型：BLSTM（双向LSTM），每个LSTM有128个隐含层</li>
<li>RNN输入：每个滑动窗口的3<em>3</em>C的特征（可以拉成一列），同一行的窗口的特征形成一个序列</li>
<li>RNN输出：每个窗口对应256维特征</li>
<li>使用RNN和不适用RNN的效果对比，CTPN是本文的方法（Connectionist Text Proposal Network）</li>
</ul>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这篇文章的方法最大亮点在于把RNN引入检测问题（以前一般做识别）。文本检测，先用CNN得到深度特征，然后用固定宽度的anchor来检测text proposal（文本线的一部分），并把同一行anchor对应的特征串成序列，输入到RNN中，最后用全连接层来分类或回归，并将正确的text proposal进行合并成文本线。这种把RNN和CNN无缝结合的方法提高了检测精度。</p>
<p><a href="http://tongtianta.site/paper/667" target="_blank" rel="noopener">翻译原文</a></p>
<p><a href="https://blog.csdn.net/zchang81/article/details/78873347" target="_blank" rel="noopener">参考——1</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/37363942" target="_blank" rel="noopener">参考——2</a></p>
<h1 id="EAST-An-Efficient-and-Accurate-Scene-Text-Detector"><a href="#EAST-An-Efficient-and-Accurate-Scene-Text-Detector" class="headerlink" title="EAST: An Efficient and Accurate Scene Text Detector"></a>EAST: An Efficient and Accurate Scene Text Detector</h1><p>旷世科技 CVPR2017</p>
<ul>
<li><a href="https://arxiv.org/pdf/1704.03155v2.pdf" target="_blank" rel="noopener">论文</a></li>
</ul>
<p><img src="https://ws1.sinaimg.cn/large/005PF9Rqly1fyb9y9y09cj319a0fsjxz.jpg" alt="image"></p>
<h2 id="1-分析目前存在的文本检测方法总结"><a href="#1-分析目前存在的文本检测方法总结" class="headerlink" title="1.分析目前存在的文本检测方法总结"></a>1.分析目前存在的文本检测方法总结</h2><ol>
<li><p>a– Reading Text in the Wild with Convolutional Neural Networks (15年vgg实验室提出,只能检测、识别水平文字)</p>
<p> 整个方法分为两部分，1.检测，使用Region Proposal mechanism检测数文字区域，然后使用Proposal Filtering(使用的是random forest方法)过滤文字候选框，最后进行一些合并调整得到Word boxes，这部分由于Bounding Box Regression不能完全覆盖文字，导致识别错误，所以又搞了个CNN网络来调整regression framework。2.识别，使用CNN一次识别出整个单词，与以往的单词分割识别再组合不同，这部分数据是人工生成的[方法1]</p>
<p> <a href="https://blog.csdn.net/u010167269/article/details/52337213" target="_blank" rel="noopener">参考文章</a><br> <a href="https://arxiv.org/pdf/1412.1842.pdf" target="_blank" rel="noopener">论文</a></p>
</li>
<li><p>b– Multi-Oriented Text Detection with Fully Convolutional Networks (2016CVPR 白翔大佬，检测多方向文字)</p>
 <div align="center"><img src="https://ws1.sinaimg.cn/large/005PF9Rqgy1fybb3s69qxj30r40j8wng.jpg" width="30%"></div>

<p> 具体方法是，将输入图片经过几层卷积得到salient map,然后使用MSER提取候选文字区域，接着候选字符提取出来，确定整个候选字符的方向，最后生成候选框</p>
<p> <a href="https://www.cnblogs.com/lillylin/p/6102708.html" target="_blank" rel="noopener">参考文章</a><br> <a href="https://arxiv.org/pdf/1604.04018.pdf" target="_blank" rel="noopener">论文</a></p>
</li>
<li><p>c – Scene Text Detection via Holistic, Multi-Channel Prediction (arXiv2016 白翔大佬在Face++的)</p>
 <div align="center"><img src="https://ws1.sinaimg.cn/large/005PF9Rqgy1fybbbnd6iij30tc0n77ef.jpg" width="30%"></div>

<p> 这个主要方法是从原图中获取三个mask，分别是文本行mask，字符mask和方向mask，然后使用这三个mask获取文本框。文本行mask数据集有，那字符和方向的mask是怎么得到的呢，通过swt得到字符mask，然后获取方向的mask.</p>
 <div align="center"><img src="https://ws1.sinaimg.cn/large/005PF9Rqgy1fybbd5jihsj30qo0nd7gr.jpg" width="30%"></div>

<p> 有三个mask怎么得到文本框的呢，可以是文本行mask得到一个文本框，使用字符框得到多个框再使用<a href="https://zh.wikipedia.org/zh-hans/%E5%BE%B7%E5%8B%9E%E5%85%A7%E4%B8%89%E8%A7%92%E5%8C%96" target="_blank" rel="noopener">德劳内三角化</a>,最后得到文本框。</p>
<p> <a href="https://zhuanlan.zhihu.com/p/44170391" target="_blank" rel="noopener">参考文章-1</a><br> <a href="https://www.cnblogs.com/lillylin/p/6138436.html" target="_blank" rel="noopener">参考文章-2</a><br> <a href="https://arxiv.org/pdf/1606.09002.pdf" target="_blank" rel="noopener">论文</a></p>
</li>
<li><p>d – Detecting Text in Natural Image with Connectionist Text Proposal Network (Weilin Huang——ECCV2016)</p>
<p> 这个就是大名鼎鼎的CTPN啦</p>
</li>
</ol>
<h2 id="2-Pipeline-网络结构"><a href="#2-Pipeline-网络结构" class="headerlink" title="2.Pipeline 网络结构"></a>2.Pipeline 网络结构</h2><p><img src="https://ws1.sinaimg.cn/large/005PF9Rqgy1fybazkncntj30jf0jpwih.jpg" alt="image"></p>
<p>分为三部分：feature extractor\feature-merging\output layer</p>
<ol>
<li><p>Feature extractor 特征提取</p>
<p> 使用PVNet提取图片特征，分别抽出1/4、1/8、1/16、1/32大小的feature map</p>
</li>
<li><p>Feature merging 特征合并</p>
<p> 将上面提取的特征上采样合并，最后得到32channel的featuare</p>
</li>
<li><p>Output layer 输出层</p>
<p> 分为两部分：score map和 RBOX or QUAD</p>
<p> score map 是使用1*1的卷积核获取的。RBOX是带角度的Box，这个分为4个geomatry map和1个rotation angle。QUAD是四个坐标点，xy两轴，所以是8个。</p>
</li>
</ol>
<h2 id="3-Label-generation"><a href="#3-Label-generation" class="headerlink" title="3.Label generation"></a>3.Label generation</h2><p><img src="https://ws1.sinaimg.cn/large/005PF9Rqly1fyc8q16sjej30s10iyjxa.jpg" alt="image"></p>
<p>当输出4个Geomatry map和一个rototion map时，label怎么生成的呢。看上图，(a)中黄色虚线框是人工标注，绿色实现框是缩小0.3后的Label，文章说这样可以避免人工标注错误带来的误差;(b)就是score map label，白色表示文本区域，黑色表示背景;(c) 生成RBOX几何映射;(d)每个像素到矩形边界的距离有4个通道;(e)旋转角度.</p>
<h2 id="4-Loss-Function"><a href="#4-Loss-Function" class="headerlink" title="4. Loss Function"></a>4. Loss Function</h2><p>$L = L _ { \mathrm { s } } + \lambda _ { \mathrm { g } } L _ { \mathrm { g } }$</p>
<p>Ls和Lg分别代表scoreh额geomatry的loss，λg代表权重，文章设为1</p>
<p>$L _ { \mathrm {s}}= - \beta \mathbf { Y } ^{<em>}\log \hat { \mathbf { Y } } - ( 1 - \beta ) \left( 1 - \mathbf { Y } ^ { </em> } \right) \log ( 1 - \hat { \mathbf { Y } } )$</p>
<p>Ls使用的是交叉熵</p>
<p>在Geomatry生成使用RBox和Quad时用不同的Loss function</p>
<p>RBox 的loss分为AABB和R两部分，Box AABB的loss是iou</p>
<p>$L _ { \mathrm { AABB } } = - \log \operatorname { IoU } \left( \hat { \mathbf { R } } , \mathbf { R } ^ { <em> } \right) = - \log \frac { \left| \hat { \mathbf { R } } \cap \mathbf { R } ^ { </em> } \right| } { \left| \hat { \mathbf { R } } \cup \mathbf { R } ^ { * } \right| }$</p>
<p>但是这里的iou是加了权重的，是加到各个边的距离的权重,角度loss使用cos 计算</p>
<p>$L _ { \theta } \left( \hat { \theta } , \theta ^ { <em> } \right) = 1 - \cos \left( \hat { \theta } - \theta ^ { </em> } \right)$</p>
<p>下面是RBox loss的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loss</span><span class="params">(y_true_cls, y_pred_cls,</span></span></span><br><span class="line"><span class="function"><span class="params">         y_true_geo, y_pred_geo,</span></span></span><br><span class="line"><span class="function"><span class="params">         training_mask)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    define the loss used for training, contraning two part,</span></span><br><span class="line"><span class="string">    the first part we use dice loss instead of weighted logloss,</span></span><br><span class="line"><span class="string">    the second part is the iou loss defined in the paper</span></span><br><span class="line"><span class="string">    :param y_true_cls: ground truth of text</span></span><br><span class="line"><span class="string">    :param y_pred_cls: prediction os text</span></span><br><span class="line"><span class="string">    :param y_true_geo: ground truth of geometry</span></span><br><span class="line"><span class="string">    :param y_pred_geo: prediction of geometry</span></span><br><span class="line"><span class="string">    :param training_mask: mask used in training, to ignore some text annotated by ###</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    classification_loss = dice_coefficient(y_true_cls, y_pred_cls, training_mask)</span><br><span class="line">    <span class="comment"># scale classification loss to match the iou loss part</span></span><br><span class="line">    classification_loss *= <span class="number">0.01</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># d1 -&gt; top, d2-&gt;right, d3-&gt;bottom, d4-&gt;left</span></span><br><span class="line">    d1_gt, d2_gt, d3_gt, d4_gt, theta_gt = tf.split(value=y_true_geo, num_or_size_splits=<span class="number">5</span>, axis=<span class="number">3</span>)</span><br><span class="line">    d1_pred, d2_pred, d3_pred, d4_pred, theta_pred = tf.split(value=y_pred_geo, num_or_size_splits=<span class="number">5</span>, axis=<span class="number">3</span>)</span><br><span class="line">    area_gt = (d1_gt + d3_gt) * (d2_gt + d4_gt)</span><br><span class="line">    area_pred = (d1_pred + d3_pred) * (d2_pred + d4_pred)</span><br><span class="line">    w_union = tf.minimum(d2_gt, d2_pred) + tf.minimum(d4_gt, d4_pred)</span><br><span class="line">    h_union = tf.minimum(d1_gt, d1_pred) + tf.minimum(d3_gt, d3_pred)</span><br><span class="line">    area_intersect = w_union * h_union</span><br><span class="line">    area_union = area_gt + area_pred - area_intersect</span><br><span class="line">    L_AABB = -tf.log((area_intersect + <span class="number">1.0</span>)/(area_union + <span class="number">1.0</span>))</span><br><span class="line">    L_theta = <span class="number">1</span> - tf.cos(theta_pred - theta_gt)</span><br><span class="line">    tf.summary.scalar(<span class="string">'geometry_AABB'</span>, tf.reduce_mean(L_AABB * y_true_cls * training_mask))</span><br><span class="line">    tf.summary.scalar(<span class="string">'geometry_theta'</span>, tf.reduce_mean(L_theta * y_true_cls * training_mask))</span><br><span class="line">    L_g = L_AABB + <span class="number">20</span> * L_theta</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> tf.reduce_mean(L_g * y_true_cls * training_mask) + classification_loss</span><br></pre></td></tr></table></figure>
<p>Quad loss, ⚆_⚆ 没看懂怎么做的，也没有代码，这里仅贴个公式吧。</p>
<p>$L _ { \mathrm { g } } = L _ { \mathrm { QUAD } } \left( \hat { \mathbf { Q } } , \mathbf { Q } ^ { <em> } \right) = \min _ { \mathbf { Q } \in P _ { Q ^ { </em> } } } \sum _ { c _ { i } \in \mathbb { C } _ { \mathbf { Q } } } \frac { \operatorname { smoothed } _ { L 1 } \left( c _ { i } - \tilde { c } _ { i } \right) } { 8 \times N _ { \mathbf { Q } ^ { * } } }$</p>
<h2 id="5-Locality-Aware-NMS"><a href="#5-Locality-Aware-NMS" class="headerlink" title="5. Locality-Aware NMS"></a>5. Locality-Aware NMS</h2><p>locality_aware_nms在标准nms的基础上加了weighted_merge，所谓weighted_merge就是将2个IOU高于某个threshold的输出框，进行基于得分的合并。合并后的输出框的坐标数值介于2个合并的输入框之间，感觉这样操作可以将所有回归出的框的坐标信息都利用起来，有助于减少位置误差，而不是像传统的nms一样，直接取分数最高的那个。</p>
<p><a href="https://blog.csdn.net/qq_14845119/article/details/78986449" target="_blank" rel="noopener">参考文章_1</a></p>
<p><a href="https://blog.csdn.net/sparkexpert/article/details/77987654" target="_blank" rel="noopener">参考文章_2</a></p>
<p><a href="http://www.voidcn.com/article/p-kmdkakvk-bqs.html" target="_blank" rel="noopener">参考文章_3</a></p>
<p><a href="https://my.oschina.net/clgo/blog/1577724" target="_blank" rel="noopener">参考文章_4</a></p>
<h1 id="AdvancedEAST"><a href="#AdvancedEAST" class="headerlink" title="AdvancedEAST"></a>AdvancedEAST</h1><ul>
<li>[代码]（<a href="https://github.com/huoyijie/AdvancedEAST）" target="_blank" rel="noopener">https://github.com/huoyijie/AdvancedEAST）</a></li>
</ul>
<h1 id="Seglink-Detecting-Oriented-Text-in-Natural-Images-by-Linking-Segments"><a href="#Seglink-Detecting-Oriented-Text-in-Natural-Images-by-Linking-Segments" class="headerlink" title="Seglink (Detecting Oriented Text in Natural Images by Linking Segments)"></a>Seglink (Detecting Oriented Text in Natural Images by Linking Segments)</h1><p><a href="https://arxiv.org/pdf/1703.06520.pdf" target="_blank" rel="noopener">论文</a></p>
<p><a href="https://github.com/bgshih/seglink" target="_blank" rel="noopener">代码</a></p>
<h2 id="1-idea"><a href="#1-idea" class="headerlink" title="1. idea"></a>1. idea</h2><ul>
<li>提出了文本行检测的两个基本组成元素：==segment==和==link==</li>
<li>提出了基于SSD的改进版网络结构(全卷积网络结果)同时预测不同尺度的segments和link</li>
<li>提出了两种link类型:　层内连接(within-layer link)和跨层连接(cross-layer link)</li>
<li>可以处理多方向和任意长度的文本</li>
<li>Pipeline</li>
<li>整个实现过程包括两部分：首先检测segments,links，然后使用融合算法得到最终文本行．具体步骤如下：</li>
</ul>
<h2 id="2-Pipeline"><a href="#2-Pipeline" class="headerlink" title="2. Pipeline"></a>2. Pipeline</h2><p>主干网络是沿用了SSD网络结构，并修改修改了最后的Pooling层，将其改为卷积层．</p>
<ul>
<li>首先用VGG16作为base net，并将VGG16的最后两个全连接层改成卷积层．</li>
<li>接着增加一些额外的卷积层，用于提取更深的特征，最后的修改SSD的Pooling层，将其改为卷积层提取不同层的feature map，文中提取了conv4_3, conv7, conv8_2, conv9_2, conv10_2, conv11．这里其实操作还是和SSD网络一样,对不同层的featuremap使用３＊３的卷积层产生最终的输出(包括segment和link)，不同特征层输出的维度是不一样的，因为除了conv4_3层外，其它层存在跨层的link．这里segment是text的带方向bbox信息(它可能是个单词，也可能是几个字符，总之是文本行的部分)，link是不同bbox的连接信息(文章将其也增加到网络中自动学习)．</li>
<li>然后通过融合规则，将segment的box信息和link信息进行融合，得到最终的文本行．</li>
</ul>
<h1 id="PixelLink"><a href="#PixelLink" class="headerlink" title="PixelLink"></a>PixelLink</h1><ul>
<li><a href="https://arxiv.org/abs/1801.01315" target="_blank" rel="noopener">论文</a></li>
<li><a href="https://github.com/ZJULearning/pixel_link" target="_blank" rel="noopener">代码</a></li>
</ul>
<h2 id="1-Abstract"><a href="#1-Abstract" class="headerlink" title="1. Abstract"></a>1. Abstract</h2><p>基于语义分割的文本检测会有文本彼此接近导致它们很难分离.这篇文章使用将同一实例像素连接在一起进行分割。</p>
<p>以前的方法都至少包含两中分类：</p>
<ol>
<li>文本\非文本分类(SegLink\EAST\TextBoxes)</li>
<li>位置回归 (SegLink\CTPN\EAST)</li>
</ol>
<p>PixelLink受Seglink启发，分别预测文本、非文本和相邻8个像素的连接.</p>
<h2 id="2-Network-Architecture"><a href="#2-Network-Architecture" class="headerlink" title="2. Network Architecture"></a>2. Network Architecture</h2><p><img src="https://ws1.sinaimg.cn/large/005PF9Rqly1fydgo4j90dj314i0m4h36.jpg" alt="image"></p>
<p>PixelLink的架构。训练CNN模型以执行两种基于像素的预测：文本/非文本预测和链接预测。经过阈值处理后，通过正向链接将正像素连接在一起，实现实例分割。然后应用minAreaRect直接从分割结果中提取边界框。使用后置滤波可以有效地消除噪音预测。为了更好地说明输入样本。虚线框中的八个热图代表八个方向上的链接预测。虽然有些词在文本/非文本预测中难以分离，但它们可以通过链接预测分离。</p>
<h3 id="2-1-PixelLink-VGG16-2s"><a href="#2-1-PixelLink-VGG16-2s" class="headerlink" title="2.1 PixelLink + VGG16 2s"></a>2.1 PixelLink + VGG16 2s</h3><p><img src="https://ws1.sinaimg.cn/large/005PF9Rqly1fydgih0khqj30j70m6n0m.jpg" alt="image"></p>
<p>PixelLink + VGG16 2s(2s表示预测图是原始图的一半)的结构。 fc6和fc7被提换成卷积层。上采样操作直接通过双线性插值完成。来自不同阶段的特征地图通过上采样和增加操作的级联进行融合。除pool5外的所有池层都采用2步幅，而pool5则采用1。因此，fc7的大小与conv5_3相同，因此合并时不需要上采样。conv 1x1,2(16) 代表具有2或16个内核的卷积层，分别用于文本/非文本预测或链接预测。</p>
<h3 id="2-2-Linking-Pixels-Together"><a href="#2-2-Linking-Pixels-Together" class="headerlink" title="2.2 Linking Pixels Together"></a>2.2 Linking Pixels Together</h3><p>像素连接过程使用两个像素查看是否同时连接，这样才将它们看成一个连接组建。</p>
<h3 id="2-3-Extraction-of-Bounding-Box"><a href="#2-3-Extraction-of-Bounding-Box" class="headerlink" title="2.3 Extraction of Bounding Box"></a>2.3 Extraction of Bounding Box</h3><p>使用miniAreaRect提取连接组建的最小外接矩形。这一步可以看出PixelLink和基于回归的方法之间的本质区别，即边界框直接从实例分割中获得，而不是位置回归。</p>
<h3 id="2-4-Filter"><a href="#2-4-Filter" class="headerlink" title="2.4 Filter"></a>2.4 Filter</h3><p>使用边界框的几何特征进行过滤</p>
<h2 id="3-Loss"><a href="#3-Loss" class="headerlink" title="3. Loss"></a>3. Loss</h2><p>$L = \lambda L _ { p i x e l } + L _ { l i n k }$</p>
<p>Lpixel 是像素分类Loss，Llink 是连接Loss。由于分任务更重要，λ设为2.</p>
<ul>
<li><p>Pixel loss</p>
<p>  图片中文字的大小可能差异很大，这样对于那些小文字就不太友好。因此使用了一种新的损失函数，Balance Cross-Entropy(平衡交叉熵)，就是为了让每个实例的权重相同。</p>
<p>  设第i个实例的面积为$S_i$ , 其上每个像素的权重为$w _ { i } = \frac { B _ { i } } { S _ { i } }$ ，$B_i$ 是实例平均像素数<br>  $B _ { i } = \frac { S } { N } , S = \sum _ { i } S _ { i } , \forall i \in { 1 , \ldots , N }$</p>
<p>  对于正负样本不平衡问题采用OHEM解决。最后的pixel loss,S实例总面积，r取3.<br>  $L _ { p i x e l } = \frac { 1 } { ( 1 + r ) S } W L _ { p i x e l _ { - } C E }$</p>
</li>
<li><p>Link loss</p>
<p>  正连接和负连接分别计算。<br>  $L_{link_{-} CE}$是链路预测的交叉熵损失矩阵。$W_{pos-link}$ 和 $W_{nge-link}$分别是正面和负面链接的权重。具体计算方法，对于像素 (i,j) 的第k个邻居：</p>
<p>  $\begin{aligned} L _ { l i n k _ { - } p o s } &amp; = W _ { p o s - l i n k } L _ { l i n k _ { - } C E } \ L _ { l i n k _ { - } n e g } &amp; = W _ { n e g _ { - } l i n k } L _ { l i n k _ { - } C E } \end{aligned}$</p>
<p>  $\begin{aligned} W _ { p o s - l i n k } ( i , j , k ) &amp; = W ( i , j ) <em> \left( Y _ { l i n k } ( i , j , k ) = = 1 \right) \ W _ { n e g _ { - } l i n k } ( i , j , k ) &amp; = W ( i , j ) </em> \left( Y _ { l i n k } ( i , j , k ) = = 0 \right) \end{aligned}$</p>
</li>
</ul>
<h2 id="4-Summary"><a href="#4-Summary" class="headerlink" title="4. Summary"></a>4. Summary</h2><ul>
<li>与CTPN，EAST，SegLink相比，PixelLink放弃了边框回归方法来检测文本行的bbox，而是采用实例分割方法，直接从分割的文本行区域得到文本行的bbox．PixelLink可以以更少额数据和更快地速度进行训练．</li>
<li>假设提取特征的主干网络结构采用VGG16(当然你也可以采用其它主干网络结构)，PixelLink不需要在imagenet预训练的模型上进行fine-tuned（即直接从头开始训练），而CTPN，EAST，SegLink都需要在imagenet预训练的模型上进行fine-tuned</li>
<li>与CTPN，EAST，SegLink相比，PixelLink对感受野的要求更少，因为每个神经元值只负责预测自己及其邻域内的状态．<br>与SegLink一样，不能检测很大的文本，这是因为link主要是用于连接相邻的segments，而不能用于检测相距较远的文本行</li>
</ul>
<p><a href="https://zhuanlan.zhihu.com/p/38171172" target="_blank" rel="noopener">参考文章_1</a></p>
<p><a href="https://blog.csdn.net/qq_14845119/article/details/80953555" target="_blank" rel="noopener">参考文章_2</a></p>
<p><a href="https://blog.csdn.net/Missayaaa/article/details/81137312" target="_blank" rel="noopener">参考文章_3</a></p>
<h1 id="Pixel-Anchor-A-Fast-Oriented-Scene-Text-Detector-with-Combined-Networks"><a href="#Pixel-Anchor-A-Fast-Oriented-Scene-Text-Detector-with-Combined-Networks" class="headerlink" title="Pixel-Anchor: A Fast Oriented Scene Text Detector with Combined Networks"></a>Pixel-Anchor: A Fast Oriented Scene Text Detector with Combined Networks</h1><p><a href="https://arxiv.org/abs/1811.07432" target="_blank" rel="noopener">论文</a></p>
<h1 id="TextBoxes"><a href="#TextBoxes" class="headerlink" title="TextBoxes"></a>TextBoxes</h1><ul>
<li><a href="https://arxiv.org/abs/1611.06779" target="_blank" rel="noopener">论文</a></li>
<li><a href="https://github.com/MhLiao/TextBoxes" target="_blank" rel="noopener">代码</a></li>
</ul>
<h2 id="1-Abstract-1"><a href="#1-Abstract-1" class="headerlink" title="1. Abstract"></a>1. Abstract</h2><p>TextBoxes的灵感来源于SSD,SSD旨在检测图像中的一般物体，但无法识别具有极高宽高比的字。在TextBoxes中提出了文本框图层来解决这个问题.</p>
<h2 id="2-Architecture"><a href="#2-Architecture" class="headerlink" title="2. Architecture"></a>2. Architecture</h2><p><img src="https://ws1.sinaimg.cn/large/005PF9Rqly1fyfv857pltj311v0fkadp.jpg" alt="image"></p>
<p>TextBoxes架构TextBoxes是一个28层完全卷积网络。其中13个是从VGG-16继承的。在VGG-16层之后增加了9个额外的卷积层。文本框图层连接到6个卷积图层。在每个Map上，文本框图层预测72个向量，它们是12个默认框的分数（2-d）和偏移量（4-d）。对所有文本框图层的聚合输出应用非最大抑制。</p>
<ul>
<li><p>文本框层</p>
<p>假设图像和特征图大小分别是Xim\Yim）和Xmap\Ymap）。在feature map位置(i,j)一个默认框$\mathbf { b } _ { 0 } = \left( x _ { 0 } , y _ { 0 } , w _ { 0 } , h _ { 0 } \right)$,文本框输出层预测输出$( \Delta x , \Delta y , \Delta w , \Delta h , c )$，对应在原图上$\mathbf { b } = ( x , y , w , h )$</p>
<p>$\begin{aligned} x &amp; = x _ { 0 } + w _ { 0 } \Delta x \ y &amp; = y _ { 0 } + h _ { 0 } \Delta y \ w &amp; = w _ { 0 } \exp ( \Delta w ) \ h &amp; = h _ { 0 } \exp ( \Delta h ) \end{aligned}$</p>
</li>
</ul>
<p>与一般物体不同，单词文本倾向于具有较大的宽高比。因此，使用包含具有较大宽高比的“长”默认框。具体而言，我们为默认box定义6种纵横比，包括1,2,3,5,7和10。但是，这会使默认框在水平方向密集而垂直稀疏，这会导致较差的匹配框。为了解决这个问题，每个默认框都设置了垂直偏移。</p>
<p><img src="https://ws1.sinaimg.cn/large/005PF9Rqgy1fygody4oo0j30ox0mqdgo.jpg" alt="image"></p>
<p>而且，在文本框图层中，采用不规则的1 <em> 5卷积滤波器而不是标准的3 </em> 3卷积滤波器。这种初始式滤波器可以产生矩形的接收区域，它可以更好地融合具有较大纵横比的字，还可以避免方形接收区带来的噪声信号。</p>
<h2 id="3-Loss-1"><a href="#3-Loss-1" class="headerlink" title="3.Loss"></a>3.Loss</h2><p>$L ( x , c , l , g ) = \frac { 1 } { N } \left( L _ { \mathrm { conf } } ( x , c ) + \alpha L _ { \mathrm { loc } } ( x , l , g ) \right)$</p>
<p>分为位置loss和置信度loss的加权和</p>
<p><a href="https://www.cnblogs.com/lillylin/p/6204099.html" target="_blank" rel="noopener">参考文章_1</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/33544892" target="_blank" rel="noopener">参考文章_2</a></p>
<p><a href="https://www.jianshu.com/p/b3c1a2f27dec" target="_blank" rel="noopener">参考文章_3</a></p>
<h1 id="TextBoxes-1"><a href="#TextBoxes-1" class="headerlink" title="TextBoxes++"></a>TextBoxes++</h1><ul>
<li><a href="https://arxiv.org/pdf/1801.02765v3.pdf" target="_blank" rel="noopener">论文</a></li>
<li><a href="https://github.com/MhLiao/TextBoxes_plusplus" target="_blank" rel="noopener">代码</a></li>
</ul>
<h1 id="TextSpotter"><a href="#TextSpotter" class="headerlink" title="TextSpotter"></a>TextSpotter</h1><h1 id="SPCNet"><a href="#SPCNet" class="headerlink" title="SPCNet"></a>SPCNet</h1><h1 id="FOST"><a href="#FOST" class="headerlink" title="FOST"></a>FOST</h1><ul>
<li><a href="https://arxiv.org/abs/1801.01671" target="_blank" rel="noopener">论文</a></li>
<li>代码没放出来，github上别人实现的都没有识别分支（* ￣ー￣），这给EAST有什么区别，你们实现了什么啊</li>
</ul>
<p><img src="https://ws1.sinaimg.cn/large/005PF9Rqly1fyedmxoh9uj30qp0jpncx.jpg" alt="image"></p>
<p>看到没就是快</p>
<p><img src="https://ws1.sinaimg.cn/large/005PF9Rqly1fyedr3fr4jj31cp0a1guz.jpg" alt="image"></p>
<p><a href="https://zhuanlan.zhihu.com/p/38655369" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/38655369</a><br><a href="https://www.cnblogs.com/skyfsm/p/9776611.html" target="_blank" rel="noopener">https://www.cnblogs.com/skyfsm/p/9776611.html</a><br><a href="https://zhuanlan.zhihu.com/p/39796620" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/39796620</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/28/命名空间/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="田小默">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="田小默的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/08/28/命名空间/" class="post-title-link" itemprop="url">命名空间</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-08-28 10:33:45" itemprop="dateCreated datePublished" datetime="2018-08-28T10:33:45+08:00">2018-08-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-10-16 10:42:58" itemprop="dateModified" datetime="2018-10-16T10:42:58+08:00">2018-10-16</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="为什么存在命名空间"><a href="#为什么存在命名空间" class="headerlink" title="为什么存在命名空间"></a>为什么存在命名空间</h1><p>随着项目的增大，名称相互冲突的可能性也再增加，不同成员、不同厂商的命名可能出现冲突，不兼容等问题。为了解决这种冲突，命名空间出现了。</p>
<h2 id="默认存在命名空间"><a href="#默认存在命名空间" class="headerlink" title="默认存在命名空间"></a>默认存在命名空间</h2><h3 id="声明区域-declaration-region"><a href="#声明区域-declaration-region" class="headerlink" title="声明区域(declaration region)"></a>声明区域(declaration region)</h3><p>可以在其中声明的区域</p>
<ul>
<li>全局声明：在函数外部声明</li>
<li>局部声明：在函数内部声明<h3 id="潜在作用区域"><a href="#潜在作用区域" class="headerlink" title="潜在作用区域"></a>潜在作用区域</h3>从声明点开始 –&gt; 声明区域末尾</li>
</ul>
<p><img src="https://ws1.sinaimg.cn/large/005PF9Rqgy1fupifijdfvj309y0d6aah.jpg" alt=""><br><img src="https://ws1.sinaimg.cn/large/005PF9Rqgy1fupij3dwdbj30c60a1jvm.jpg" alt=""></p>
<h2 id="自定义的命名空间"><a href="#自定义的命名空间" class="headerlink" title="自定义的命名空间"></a>自定义的命名空间</h2><p>自定义命名空间，提供一个声明名称的区域，一个命名空间中的名称不会与另一个命名空间中的名称冲突，同时其他部分可以使用命名空间中的东西。关键字：namespace</p>
<h3 id="using-声明-v-s-using-编译指令"><a href="#using-声明-v-s-using-编译指令" class="headerlink" title="using 声明 v.s using 编译指令"></a>using 声明 v.s using 编译指令</h3><p>先留个坑，慢慢填</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/05/tensorflow-c-踩的坑/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="田小默">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="田小默的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/08/05/tensorflow-c-踩的坑/" class="post-title-link" itemprop="url">tensorflow c++踩的坑</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-08-05 10:31:05" itemprop="dateCreated datePublished" datetime="2018-08-05T10:31:05+08:00">2018-08-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-10-16 10:32:42" itemprop="dateModified" datetime="2018-10-16T10:32:42+08:00">2018-10-16</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题1：头文件找不到"><a href="#问题1：头文件找不到" class="headerlink" title="问题1：头文件找不到"></a>问题1：头文件找不到</h2><ul>
<li>编译tensorflow源码时添加环境变量<br>几种方式：</li>
</ul>
<ol>
<li>打开 /etc/profile 文件，在末尾添加 export PATH=(自己的路径)$PATH</li>
<li>把编译好的文件复制到 /usr/local/install/ 中</li>
</ol>
<ul>
<li>编译时tensorflow的一些头文件找不到<br>看错误提示，到相应的文件夹下看看有没有相应的文件</li>
</ul>
<ol>
<li>存在，说名环境变量没有设置正确</li>
<li>若不存在，看看是否存在同样文件名的 .proto 文件，使用 protoc 生成 .cpp 和 .h 文件</li>
<li>若也不存在 .proto文件，使用 find |grep 文件名，找到相应文件，可以复制到错误提示的文件夹中，或者把当前路径添加到环境变量中(原文件中使用的名字需要作相应的改动改动)</li>
</ol>
<h2 id="自己写的文件中方法找不到"><a href="#自己写的文件中方法找不到" class="headerlink" title="自己写的文件中方法找不到"></a>自己写的文件中方法找不到</h2><p>ctrl + 点击，跳转到源文件中查看源码，若却是不存在，使用 grep 在源文件中搜索定义的地方，然后在自己的代码中替换,并作相应修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">xzp@xzp-HP-Pavilion-Notebook:/usr/local/include/tf$ grep ends_with /usr/local/include/tf -r</span><br><span class="line">/usr/local/include/tf/tensorflow/docs_src/tutorials/images/image_recognition.md:  if (tensorflow::StringPiece(file_name).ends_with(&quot;.png&quot;)) &#123;</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/stubs/stringpiece.h:  bool ends_with(StringPiece x) const &#123;</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/stubs/stringpiece.cc:  if (ends_with(x)) &#123;</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/stubs/stringpiece_unittest.cc:  EXPECT_TRUE(a.ends_with(a));</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/stubs/stringpiece_unittest.cc:  EXPECT_TRUE(a.ends_with(&quot;bar&quot;));</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/stubs/stringpiece_unittest.cc:  EXPECT_TRUE(a.ends_with(e));</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/stubs/stringpiece_unittest.cc:  EXPECT_TRUE(b.ends_with(s1));</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/stubs/stringpiece_unittest.cc:  EXPECT_TRUE(b.ends_with(b));</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/stubs/stringpiece_unittest.cc:  EXPECT_TRUE(b.ends_with(e));</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/stubs/stringpiece_unittest.cc:  EXPECT_TRUE(e.ends_with(&quot;&quot;));</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/stubs/stringpiece_unittest.cc:  EXPECT_TRUE(!a.ends_with(b));</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/stubs/stringpiece_unittest.cc:  EXPECT_TRUE(!b.ends_with(a));</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/stubs/stringpiece_unittest.cc:  EXPECT_TRUE(!e.ends_with(a));</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/stubs/stringpiece_unittest.cc:  // ends_with</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/stubs/stringpiece_unittest.cc:  EXPECT_TRUE(abc.ends_with(abc));</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/stubs/stringpiece_unittest.cc:  EXPECT_TRUE(!abc.ends_with(&quot;abcdefguvwxyz&quot;));</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/stubs/stringpiece_unittest.cc:  EXPECT_TRUE(abc.ends_with(&quot;nopqrstuvwxyz&quot;));</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/protobuf/src/google/protobuf/util/internal/utility.cc:  return text.ends_with(suffix);</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/absl/absl/strings/match.h:// Returns whether a given std::string `text` ends with `ends_with`, ignoring case</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/googletest/googlemock/test/gmock-matchers_test.cc:  Matcher&lt;const string&amp;&gt; ends_with_ok = EndsWith(&quot;ok&quot;);</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/googletest/googlemock/test/gmock-matchers_test.cc:  ASSERT_THAT(&quot;book&quot;, ends_with_ok);</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/googletest/googlemock/test/gmock-matchers_test.cc:  EXPECT_NONFATAL_FAILURE(EXPECT_THAT(bad, ends_with_ok),</span><br><span class="line">/usr/local/include/tf/tensorflow/contrib/makefile/downloads/re2/re2/stringpiece.h:  bool ends_with(const StringPiece&amp; x) const &#123;</span><br><span class="line">xzp@xzp-HP-Pavilion-Notebook:/usr/local/include/tf$</span><br></pre></td></tr></table></figure></p>
<h2 id="protoc-命令使用踩过的坑"><a href="#protoc-命令使用踩过的坑" class="headerlink" title="protoc 命令使用踩过的坑"></a>protoc 命令使用踩过的坑</h2><ol>
<li>版本不正确<br>把目前使用的protoc 卸载，然后安装相应的版本，如果使用 apt remove protoc 卸载失败，可以直接在/usr/local/include/ 中把 头文件文件夹删了，在 /usr/local/bin/ 中把 protoc 删除</li>
<li>找不到依赖的 .proto 文件，使用 protoc -I=相应路径 这种方式(如：sudo protoc -I=/usr/local/include/tf/ -I=. –cpp_out=. cluster.proto )</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/19/IIC驱动调试踩坑/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="田小默">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="田小默的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/19/IIC驱动调试踩坑/" class="post-title-link" itemprop="url">IIC驱动调试踩坑</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-19 11:09:18 / Modified: 12:10:57" itemprop="dateCreated datePublished" datetime="2018-06-19T11:09:18+08:00">2018-06-19</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近需要使用一个ad的加速度传感器，虽然传感器提供SPI和IIC两种通信方式，由于传感器与主控芯片连接有一定距离，所以只能使用IIC。但是主控芯片使用的是ST cortex-M4内核的芯片，ST的IIC使用硬件总线的话总是有些问题，所以使用模拟IIC。</p>
<h3 id="1-驱动编写"><a href="#1-驱动编写" class="headerlink" title="1.驱动编写"></a>1.驱动编写</h3><p>官方只给了一个ad自家芯片驱动的SPI例程，所以只能自己写驱动。</p>
<p><img src="https://ws1.sinaimg.cn/large/005PF9Rqgy1fsgbqnbm89j30pa0b477g.jpg" alt="image"></p>
<p>按照数据手册和时序图，写完驱动。</p>
<h3 id="2-调试驱动"><a href="#2-调试驱动" class="headerlink" title="2.调试驱动"></a>2.调试驱动</h3><h4 id="2-1-IIC发送无回复应答"><a href="#2-1-IIC发送无回复应答" class="headerlink" title="2.1 IIC发送无回复应答"></a>2.1 IIC发送无回复应答</h4><p>驱动完成以后需要调试，刚开始IIC根本收不到回复，</p>
<pre><code>w_ack = 1
w_ack = 1
w_ack = 1
ui8temp  = 0x 0
w_ack = 1
w_ack = 1
w_ack = 1
</code></pre><p>又重新看了下时序和代码，发现代码没什么问题，后来重启了一下，可以成功收到回复</p>
<pre><code>w_ack = 0
w_ack = 0
w_ack = 0
ui8temp  = 0x 0
w_ack = 0
w_ack = 0
w_ack = 0
</code></pre><p>有时候串口也会受到J-link的影响，可能是电路有点问题。</p>
<h4 id="2-2-数据读取不出来"><a href="#2-2-数据读取不出来" class="headerlink" title="2.2 数据读取不出来"></a>2.2 数据读取不出来</h4><p>虽然应答可以收到，但还是取不出数据，仔细看了数据手册，发现有一处细节没有注意。<br><img src="https://ws1.sinaimg.cn/large/005PF9Rqgy1fsgcg0hpo8j30oj045my7.jpg" alt="image"></p>
<p>上图红色圈到的地方，在发送完寄存器地址后，收到应答应该再次发送IIC start信号，但是给遗漏了。加上重新发送开始信号后，可以读到数据。</p>
<pre><code>0xed
0xff
0xff
0xff
0xff
0xff
</code></pre><h4 id="2-3-只能读到一次数据"><a href="#2-3-只能读到一次数据" class="headerlink" title="2.3 只能读到一次数据"></a>2.3 只能读到一次数据</h4><p>虽然数据可以读到，但是如上面看到的，只有第一次可以读到，后续还是没有数据。这时我把最后一个ACK改成了1，但是还是依然如此，忽然想起来好像是我将时钟分频改了，又原来的168改成了8所以导致这种结果。</p>
<h4 id="2-4-隔一次读到一次"><a href="#2-4-隔一次读到一次" class="headerlink" title="2.4 隔一次读到一次"></a>2.4 隔一次读到一次</h4><p>改后是可以读到数据了，但是隔一次读一个，这又是哪出问题了，示波器看波形。<br><img src="https://ws1.sinaimg.cn/large/005PF9Rqgy1fsgcub1rrmj30g10783ys.jpg" alt="image"></p>
<p><img src="https://ws1.sinaimg.cn/large/005PF9Rqgy1fsgcuksbcbj30gf07mmxg.jpg" alt="image"></p>
<p>呃，什么情况，本来空闲状态都应该是高电平的，这么一会高一会低。</p>
<p>有点崩溃了，后来来回找了好久，才发现，上次把最后一个ACK给搞错了。改回低电平，成功读取数据。</p>
<h3 id="3-总结"><a href="#3-总结" class="headerlink" title="3.总结"></a>3.总结</h3><p>驱动的编写调试是嵌入式编程的基础，但这也是最复杂最让人厌烦的事情，需要耐心和细心。</p>
<p>韩智鸿老师说波形有些杂波，韩老师建议加104p旁路电容。IIC需要加4k7的电阻。</p>
<p>感谢韩智鸿老师和linuxhan的帮助。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/11/Learning-Compression-Algorithms-for-Neural-Net-Pruning/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="田小默">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="田小默的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/11/Learning-Compression-Algorithms-for-Neural-Net-Pruning/" class="post-title-link" itemprop="url">Learning-Compression Algorithms for Neural Net Pruning</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-11 09:54:15" itemprop="dateCreated datePublished" datetime="2018-06-11T09:54:15+08:00">2018-06-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-25 20:53:31" itemprop="dateModified" datetime="2018-12-25T20:53:31+08:00">2018-12-25</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/30/python笔记/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="田小默">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="田小默的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/05/30/python笔记/" class="post-title-link" itemprop="url">python笔记</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-05-30 17:27:59" itemprop="dateCreated datePublished" datetime="2018-05-30T17:27:59+08:00">2018-05-30</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-10-16 10:38:43" itemprop="dateModified" datetime="2018-10-16T10:38:43+08:00">2018-10-16</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><h3 id="三元运算符"><a href="#三元运算符" class="headerlink" title="三元运算符"></a>三元运算符</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">其他语言：</span><br><span class="line">    a = x&gt;y:x?y</span><br><span class="line">python:</span><br><span class="line">    a = x if x&gt;y else y</span><br></pre></td></tr></table></figure>
<h3 id="set"><a href="#set" class="headerlink" title="set()"></a>set()</h3><h2 id="装饰器和神奇的"><a href="#装饰器和神奇的" class="headerlink" title="装饰器和神奇的@"></a>装饰器和神奇的@</h2><ul>
<li>装饰器 Decorator<br>在程序运行期间动态增加功能的方式称为‘装饰器’。其实就是高阶函数，把原来的函数作为装饰器的参数运行，然后返回一个闭包代替原来函数。装饰器可以在运行函数前进行预处理，如参数类型检查等。</li>
</ul>
<p>使用装饰器的时候，定义函数/对象方法前使用 @ 。</p>
<ul>
<li><p>简单装饰器及装饰器运行机制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; def log(func):</span><br><span class="line">...     def wrapper(*args,**kw):</span><br><span class="line">...         print(&apos;call %s():&apos; %func.__name__)</span><br><span class="line">...         return func(*args,**kw)</span><br><span class="line">...     return wrapper</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; @log #装饰一下</span><br><span class="line">... def now():</span><br><span class="line">...     print(&apos;2018-7-24&apos;)</span><br><span class="line">...     return &apos;done&apos;</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; now() #运行时相当于运行 log(now()) -&gt; wrapper(now())</span><br><span class="line">call now():</span><br><span class="line">2018-7-24</span><br><span class="line">&apos;done&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>传参装饰器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; def log(text):</span><br><span class="line">...     def decorator(func):</span><br><span class="line">...         def wrapper(*args, **kw):</span><br><span class="line">...             print &apos;%s %s():&apos; % (text, func.__name__)</span><br><span class="line">...             return func(*args, **kw)</span><br><span class="line">...         return wrapper</span><br><span class="line">...     return decorator</span><br><span class="line">... </span><br><span class="line">&gt;&gt;&gt; @log(&apos;execute&apos;)</span><br><span class="line">... def now():</span><br><span class="line">...     print &apos;2015-10-26&apos;</span><br><span class="line">...     return &quot;done&quot;</span><br><span class="line">... </span><br><span class="line">&gt;&gt;&gt; now() #运行时相当于运行 log(now()) -&gt; wrapper(now())</span><br><span class="line">excute now()</span><br><span class="line">2018-7-24</span><br><span class="line">&apos;done&apos;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h2><h3 id="list-to-str"><a href="#list-to-str" class="headerlink" title="list to str"></a>list to str</h3><pre><code>&apos;&apos;.join(str(x) for x in list)
</code></pre><h1 id="builtins-内容"><a href="#builtins-内容" class="headerlink" title="builtins 内容"></a><strong>builtins</strong> 内容</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">&apos;ArithmeticError&apos;</span><br><span class="line">&apos;AssertionError&apos;</span><br><span class="line">&apos;AttributeError&apos;</span><br><span class="line">&apos;BaseException&apos;</span><br><span class="line">&apos;BlockingIOError&apos;</span><br><span class="line">&apos;BrokenPipeError&apos;</span><br><span class="line">&apos;BufferError&apos;</span><br><span class="line">&apos;BytesWarning&apos;</span><br><span class="line">&apos;ChildProcessError&apos;</span><br><span class="line">&apos;ConnectionAbortedError&apos;</span><br><span class="line">&apos;ConnectionError&apos;</span><br><span class="line">&apos;ConnectionRefusedError&apos;</span><br><span class="line">&apos;ConnectionResetError&apos;</span><br><span class="line">&apos;DeprecationWarning&apos;</span><br><span class="line">&apos;EOFError&apos;</span><br><span class="line">&apos;Ellipsis&apos;</span><br><span class="line">&apos;EnvironmentError&apos;</span><br><span class="line">&apos;Exception&apos;</span><br><span class="line">&apos;False&apos;</span><br><span class="line">&apos;FileExistsError&apos;</span><br><span class="line">&apos;FileNotFoundError&apos;</span><br><span class="line">&apos;FloatingPointError&apos;</span><br><span class="line">&apos;FutureWarning&apos;</span><br><span class="line">&apos;GeneratorExit&apos;</span><br><span class="line">&apos;IOError&apos;</span><br><span class="line">&apos;ImportError&apos;</span><br><span class="line">&apos;ImportWarning&apos;</span><br><span class="line">&apos;IndentationError&apos;</span><br><span class="line">&apos;IndexError&apos;</span><br><span class="line">&apos;InterruptedError&apos;</span><br><span class="line">&apos;IsADirectoryError&apos;</span><br><span class="line">&apos;KeyError&apos;</span><br><span class="line">&apos;KeyboardInterrupt&apos;</span><br><span class="line">&apos;LookupError&apos;</span><br><span class="line">&apos;MemoryError&apos;</span><br><span class="line">&apos;NameError&apos;</span><br><span class="line">&apos;None&apos;</span><br><span class="line">&apos;NotADirectoryError&apos;</span><br><span class="line">&apos;NotImplemented&apos;</span><br><span class="line">&apos;NotImplementedError&apos;</span><br><span class="line">&apos;OSError&apos;</span><br><span class="line">&apos;OverflowError&apos;</span><br><span class="line">&apos;PendingDeprecationWarning&apos;</span><br><span class="line">&apos;PermissionError&apos;</span><br><span class="line">&apos;ProcessLookupError&apos;</span><br><span class="line">&apos;RecursionError&apos;</span><br><span class="line">&apos;ReferenceError&apos;</span><br><span class="line">&apos;ResourceWarning&apos;</span><br><span class="line">&apos;RuntimeError&apos;</span><br><span class="line">&apos;RuntimeWarning&apos;</span><br><span class="line">&apos;StopAsyncIteration&apos;</span><br><span class="line">&apos;StopIteration&apos;</span><br><span class="line">&apos;SyntaxError&apos;</span><br><span class="line">&apos;SyntaxWarning&apos;</span><br><span class="line">&apos;SystemError&apos;</span><br><span class="line">&apos;SystemExit&apos;</span><br><span class="line">&apos;TabError&apos;</span><br><span class="line">&apos;TimeoutError&apos;</span><br><span class="line">&apos;True&apos;</span><br><span class="line">&apos;TypeError&apos;</span><br><span class="line">&apos;UnboundLocalError&apos;</span><br><span class="line">&apos;UnicodeDecodeError&apos;</span><br><span class="line">&apos;UnicodeEncodeError&apos;</span><br><span class="line">&apos;UnicodeError&apos;</span><br><span class="line">&apos;UnicodeTranslateError&apos;</span><br><span class="line">&apos;UnicodeWarning&apos;</span><br><span class="line">&apos;UserWarning&apos;</span><br><span class="line">&apos;ValueError&apos;</span><br><span class="line">&apos;Warning&apos;</span><br><span class="line">&apos;WindowsError&apos;</span><br><span class="line">&apos;ZeroDivisionError&apos;</span><br><span class="line">&apos;_&apos;</span><br><span class="line">&apos;__build_class__&apos;</span><br><span class="line">&apos;__debug__&apos;</span><br><span class="line">&apos;__doc__&apos;</span><br><span class="line">&apos;__import__&apos;</span><br><span class="line">&apos;__loader__&apos;</span><br><span class="line">&apos;__name__&apos;</span><br><span class="line">&apos;__package__&apos;</span><br><span class="line">&apos;__spec__&apos;</span><br><span class="line">&apos;abs&apos;</span><br><span class="line">&apos;all&apos;</span><br><span class="line">&apos;any&apos;</span><br><span class="line">&apos;ascii&apos;</span><br><span class="line">&apos;bin&apos;</span><br><span class="line">&apos;bool&apos;</span><br><span class="line">&apos;bytearray&apos;</span><br><span class="line">&apos;bytes&apos;</span><br></pre></td></tr></table></figure>
<h5 id="callable"><a href="#callable" class="headerlink" title="callable()"></a>callable()</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    函数用于检查一个对象是否是可调用的。如果返回True，object仍然可能调用失败；但如果返回False，调用对象ojbect绝对不会成功。</span><br><span class="line">    </span><br><span class="line">    对于函数, 方法, lambda 函式, 类, 以及实现了 __call__ 方法的类实例, 它都返回 True。</span><br><span class="line"></span><br><span class="line">callable(object)</span><br><span class="line">para:   object -- 对象</span><br><span class="line">返回值:可调用返回 True，否则返回 False。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&apos;chr&apos;</span><br><span class="line">&apos;classmethod&apos;</span><br><span class="line">&apos;compile&apos;</span><br><span class="line">&apos;complex&apos;</span><br><span class="line">&apos;copyright&apos;</span><br><span class="line">&apos;credits&apos;</span><br><span class="line">&apos;delattr&apos;</span><br><span class="line">&apos;dict&apos;</span><br><span class="line">&apos;dir&apos;</span><br><span class="line">&apos;divmod&apos;</span><br><span class="line">&apos;enumerate&apos;</span><br></pre></td></tr></table></figure>
<h5 id="eval"><a href="#eval" class="headerlink" title="eval()"></a>eval()</h5><p>把输入字符串当作表达式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&apos;exec&apos;</span><br><span class="line">&apos;exit&apos;</span><br><span class="line">&apos;filter&apos;</span><br><span class="line">&apos;float&apos;</span><br><span class="line">&apos;format&apos;</span><br><span class="line">&apos;frozenset&apos;</span><br><span class="line">&apos;getattr&apos;</span><br><span class="line">&apos;globals&apos;</span><br><span class="line">&apos;hasattr&apos;</span><br><span class="line">&apos;hash&apos;</span><br><span class="line">&apos;help&apos;</span><br><span class="line">&apos;hex&apos;</span><br><span class="line">&apos;id&apos;</span><br><span class="line">&apos;input&apos;</span><br><span class="line">&apos;int&apos;</span><br></pre></td></tr></table></figure></p>
<h5 id="int"><a href="#int" class="headerlink" title="int()"></a>int()</h5><p>int()用于取整，且只能向下取整，并不能四舍五入<br>round() 有四舍五入功能<br>若想实现向上取整的功能，可以使用round(values + 0.5)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; int(1.3)</span><br><span class="line">1</span><br><span class="line">&gt;&gt;&gt; int(1.8)</span><br><span class="line">1</span><br><span class="line">&gt;&gt;&gt; round(1.3)</span><br><span class="line">1</span><br><span class="line">&gt;&gt;&gt; round(1.8)</span><br><span class="line">2</span><br><span class="line">&gt;&gt;&gt; round(1.3 + 0.5)</span><br><span class="line">2</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&apos;isinstance&apos;</span><br><span class="line">&apos;issubclass&apos;</span><br><span class="line">&apos;iter&apos;</span><br><span class="line">&apos;len&apos;</span><br><span class="line">&apos;license&apos;</span><br><span class="line">&apos;list&apos;</span><br><span class="line">&apos;locals&apos;</span><br><span class="line">&apos;map&apos;</span><br><span class="line">&apos;max&apos;</span><br><span class="line">&apos;memoryview&apos;</span><br><span class="line">&apos;min&apos;</span><br><span class="line">&apos;next&apos;</span><br><span class="line">&apos;object&apos;</span><br><span class="line">&apos;oct&apos;</span><br><span class="line">&apos;open&apos;</span><br><span class="line">&apos;ord&apos;</span><br><span class="line">&apos;pow&apos;</span><br><span class="line">&apos;print&apos;</span><br></pre></td></tr></table></figure>
<h5 id="property"><a href="#property" class="headerlink" title="property()"></a>property()</h5><ul>
<li>将类的方法转为只读属性</li>
<li>重新实现一个属性的setter和getter方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">class Person(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, first_name, last_name):</span><br><span class="line">        self.first_name = first_name</span><br><span class="line">        self.last_name = last_name</span><br><span class="line"> </span><br><span class="line">    @property</span><br><span class="line">    def full_name(self):</span><br><span class="line">        return &quot;%s %s&quot; % (self.first_name, self.last_name)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; person = Person(&quot;Mike&quot;, &quot;Driscoll&quot;)</span><br><span class="line">&gt;&gt;&gt; person.full_name</span><br><span class="line">&apos;Mike Driscoll&apos;</span><br><span class="line">&gt;&gt;&gt; person.first_name</span><br><span class="line">&apos;Mike&apos;</span><br><span class="line">&gt;&gt;&gt; person.full_name = &quot;Jackalope&quot;</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;string&gt;&quot;, line 1, in &lt;fragment&gt;</span><br><span class="line">AttributeError: can&apos;t set attribute</span><br><span class="line">&gt;&gt;&gt; person.first_name = &quot;Dan&quot;</span><br><span class="line">&gt;&gt;&gt; person.full_name</span><br><span class="line">&apos;Dan Driscoll&apos;</span><br><span class="line"></span><br><span class="line">#原来一个类都是这样</span><br><span class="line">&gt;&gt;&gt; class Fees(object):</span><br><span class="line">...     def __init__(self):</span><br><span class="line">...         self._fee = None</span><br><span class="line">...     def get_fee(self):</span><br><span class="line">...         return self._fee</span><br><span class="line">...     def set_fee(self,value):</span><br><span class="line">...         self._fee=value</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; f = Fees()</span><br><span class="line">&gt;&gt;&gt; f.set_fee(1)</span><br><span class="line">&gt;&gt;&gt; f.get_fee()</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">#用property改一下</span><br><span class="line">&gt;&gt;&gt; class Fees(object):</span><br><span class="line">...     def __init__(self):</span><br><span class="line">...         self._fee = None</span><br><span class="line">...     def get_fee(self):</span><br><span class="line">...         return self._fee</span><br><span class="line">...     def set_fee(self,value):</span><br><span class="line">...         self._fee=value</span><br><span class="line">...     fee = property(get_fee,set_fee)</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; f = Fees()</span><br><span class="line">&gt;&gt;&gt; f.fee = 1</span><br><span class="line">&gt;&gt;&gt; f.fee</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; class Fees(object):</span><br><span class="line">...     def __init__(self):</span><br><span class="line">...         self._fee = None</span><br><span class="line">...     @property</span><br><span class="line">...     def fee(self):</span><br><span class="line">...         return self._fee</span><br><span class="line">...     @fee.setter</span><br><span class="line">...     def fee(self,value):</span><br><span class="line">...         self._fee=value</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; f = Fees()</span><br><span class="line">&gt;&gt;&gt; f.fee = 2</span><br><span class="line">&gt;&gt;&gt; f.fee</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&apos;quit&apos;</span><br><span class="line">&apos;range&apos;</span><br><span class="line">&apos;repr&apos;</span><br><span class="line">&apos;reversed&apos;</span><br></pre></td></tr></table></figure>
<h5 id="round"><a href="#round" class="headerlink" title="round()"></a>round()</h5><p>round()四舍五入，参考int()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&apos;set&apos;</span><br><span class="line">&apos;setattr&apos;</span><br><span class="line">&apos;slice&apos;</span><br><span class="line">&apos;sorted&apos;</span><br><span class="line">&apos;staticmethod&apos;</span><br><span class="line">&apos;str&apos;</span><br></pre></td></tr></table></figure></p>
<h3 id="sum"><a href="#sum" class="headerlink" title="sum()"></a>sum()</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a</span><br><span class="line">[1, 2, 3]</span><br><span class="line">&gt;&gt;&gt; sum(a)</span><br><span class="line">6</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&apos;super&apos;</span><br><span class="line">&apos;tuple&apos;</span><br><span class="line">&apos;type&apos;</span><br><span class="line">&apos;vars&apos;</span><br><span class="line">&apos;zip&apos;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">To solve this problem, we need to understand &quot;What is the use of median&quot;. In statistics, the median is used for dividing a set into two equal length subsets, that one subset is always greater than the other. If we understand the use of median for dividing, we are very close to the answer.</span><br><span class="line"></span><br><span class="line">First let&apos;s cut A into two parts at a random position i:</span><br><span class="line"></span><br><span class="line">      left_A             |        right_A</span><br><span class="line">A[0], A[1], ..., A[i-1]  |  A[i], A[i+1], ..., A[m-1]</span><br><span class="line">Since A has m elements, so there are m+1 kinds of cutting( i = 0 ~ m ). And we know: len(left_A) = i, len(right_A) = m - i . Note: when i = 0 , left_A is empty, and when i = m , right_A is empty.</span><br><span class="line"></span><br><span class="line">With the same way, cut B into two parts at a random position j:</span><br><span class="line"></span><br><span class="line">      left_B             |        right_B</span><br><span class="line">B[0], B[1], ..., B[j-1]  |  B[j], B[j+1], ..., B[n-1]</span><br><span class="line">Put left_A and left_B into one set, and put right_A and right_B into another set. Let&apos;s name them left_part and right_part :</span><br><span class="line"></span><br><span class="line">      left_part          |        right_part</span><br><span class="line">A[0], A[1], ..., A[i-1]  |  A[i], A[i+1], ..., A[m-1]</span><br><span class="line">B[0], B[1], ..., B[j-1]  |  B[j], B[j+1], ..., B[n-1]</span><br><span class="line">If we can ensure:</span><br><span class="line"></span><br><span class="line">1) len(left_part) == len(right_part)</span><br><span class="line">2) max(left_part) &lt;= min(right_part)</span><br><span class="line">then we divide all elements in &#123;A, B&#125; into two parts with equal length, and one part is always greater than the other. Then median = (max(left_part) + min(right_part))/2.</span><br><span class="line"></span><br><span class="line">To ensure these two conditions, we just need to ensure:</span><br><span class="line"></span><br><span class="line">(1) i + j == m - i + n - j (or: m - i + n - j + 1)</span><br><span class="line">    if n &gt;= m, we just need to set: i = 0 ~ m, j = (m + n + 1)/2 - i</span><br><span class="line">(2) B[j-1] &lt;= A[i] and A[i-1] &lt;= B[j]</span><br><span class="line">ps.1 For simplicity, I presume A[i-1],B[j-1],A[i],B[j] are always valid even if i=0/i=m/j=0/j=n . I will talk about how to deal with these edge values at last.</span><br><span class="line"></span><br><span class="line">ps.2 Why n &gt;= m? Because I have to make sure j is non-nagative since 0 &lt;= i &lt;= m and j = (m + n + 1)/2 - i. If n &lt; m , then j may be nagative, that will lead to wrong result.</span><br><span class="line"></span><br><span class="line">So, all we need to do is:</span><br><span class="line"></span><br><span class="line">Searching i in [0, m], to find an object `i` that:</span><br><span class="line">    B[j-1] &lt;= A[i] and A[i-1] &lt;= B[j], ( where j = (m + n + 1)/2 - i )</span><br><span class="line">And we can do a binary search following steps described below:</span><br><span class="line"></span><br><span class="line">&lt;1&gt; Set imin = 0, imax = m, then start searching in [imin, imax]</span><br><span class="line"></span><br><span class="line">&lt;2&gt; Set i = (imin + imax)/2, j = (m + n + 1)/2 - i</span><br><span class="line"></span><br><span class="line">&lt;3&gt; Now we have len(left_part)==len(right_part). And there are only 3 situations</span><br><span class="line">     that we may encounter:</span><br><span class="line">    &lt;a&gt; B[j-1] &lt;= A[i] and A[i-1] &lt;= B[j]</span><br><span class="line">        Means we have found the object `i`, so stop searching.</span><br><span class="line">    &lt;b&gt; B[j-1] &gt; A[i]</span><br><span class="line">        Means A[i] is too small. We must `ajust` i to get `B[j-1] &lt;= A[i]`.</span><br><span class="line">        Can we `increase` i?</span><br><span class="line">            Yes. Because when i is increased, j will be decreased.</span><br><span class="line">            So B[j-1] is decreased and A[i] is increased, and `B[j-1] &lt;= A[i]` may</span><br><span class="line">            be satisfied.</span><br><span class="line">        Can we `decrease` i?</span><br><span class="line">            `No!` Because when i is decreased, j will be increased.</span><br><span class="line">            So B[j-1] is increased and A[i] is decreased, and B[j-1] &lt;= A[i] will</span><br><span class="line">            be never satisfied.</span><br><span class="line">        So we must `increase` i. That is, we must ajust the searching range to</span><br><span class="line">        [i+1, imax]. So, set imin = i+1, and goto &lt;2&gt;.</span><br><span class="line">    &lt;c&gt; A[i-1] &gt; B[j]</span><br><span class="line">        Means A[i-1] is too big. And we must `decrease` i to get `A[i-1]&lt;=B[j]`.</span><br><span class="line">        That is, we must ajust the searching range to [imin, i-1].</span><br><span class="line">        So, set imax = i-1, and goto &lt;2&gt;.</span><br><span class="line">When the object i is found, the median is:</span><br><span class="line"></span><br><span class="line">max(A[i-1], B[j-1]) (when m + n is odd)</span><br><span class="line">or (max(A[i-1], B[j-1]) + min(A[i], B[j]))/2 (when m + n is even)</span><br><span class="line">Now let&apos;s consider the edges values i=0,i=m,j=0,j=n where A[i-1],B[j-1],A[i],B[j] may not exist. Actually this situation is easier than you think.</span><br><span class="line"></span><br><span class="line">What we need to do is ensuring that max(left_part) &lt;= min(right_part). So, if i and j are not edges values(means A[i-1],B[j-1],A[i],B[j] all exist), then we must check both B[j-1] &lt;= A[i] and A[i-1] &lt;= B[j]. But if some of A[i-1],B[j-1],A[i],B[j] don&apos;t exist, then we don&apos;t need to check one(or both) of these two conditions. For example, if i=0, then A[i-1] doesn&apos;t exist, then we don&apos;t need to check A[i-1] &lt;= B[j]. So, what we need to do is:</span><br><span class="line"></span><br><span class="line">Searching i in [0, m], to find an object `i` that:</span><br><span class="line">    (j == 0 or i == m or B[j-1] &lt;= A[i]) and</span><br><span class="line">    (i == 0 or j == n or A[i-1] &lt;= B[j])</span><br><span class="line">    where j = (m + n + 1)/2 - i</span><br><span class="line">And in a searching loop, we will encounter only three situations:</span><br><span class="line"></span><br><span class="line">&lt;a&gt; (j == 0 or i == m or B[j-1] &lt;= A[i]) and</span><br><span class="line">    (i == 0 or j = n or A[i-1] &lt;= B[j])</span><br><span class="line">    Means i is perfect, we can stop searching.</span><br><span class="line"></span><br><span class="line">&lt;b&gt; j &gt; 0 and i &lt; m and B[j - 1] &gt; A[i]</span><br><span class="line">    Means i is too small, we must increase it.</span><br><span class="line"></span><br><span class="line">&lt;c&gt; i &gt; 0 and j &lt; n and A[i - 1] &gt; B[j]</span><br><span class="line">    Means i is too big, we must decrease it.</span><br><span class="line">Thank @Quentin.chen , him pointed out that: i &lt; m ==&gt; j &gt; 0 and i &gt; 0 ==&gt; j &lt; n . Because:</span><br><span class="line"></span><br><span class="line">m &lt;= n, i &lt; m ==&gt; j = (m+n+1)/2 - i &gt; (m+n+1)/2 - m &gt;= (2*m+1)/2 - m &gt;= 0    </span><br><span class="line">m &lt;= n, i &gt; 0 ==&gt; j = (m+n+1)/2 - i &lt; (m+n+1)/2 &lt;= (2*n+1)/2 &lt;= n</span><br><span class="line">So in situation &lt;b&gt; and &lt;c&gt;, we don&apos;t need to check whether j &gt; 0 and whether j &lt; n.</span><br><span class="line"></span><br><span class="line">Below is the accepted code:</span><br><span class="line"></span><br><span class="line"> def median(A, B):</span><br><span class="line">    m, n = len(A), len(B)</span><br><span class="line">    if m &gt; n:</span><br><span class="line">        A, B, m, n = B, A, n, m</span><br><span class="line">    if n == 0:</span><br><span class="line">        raise ValueError</span><br><span class="line"></span><br><span class="line">    imin, imax, half_len = 0, m, (m + n + 1) / 2</span><br><span class="line">    while imin &lt;= imax:</span><br><span class="line">        i = (imin + imax) / 2</span><br><span class="line">        j = half_len - i</span><br><span class="line">        if i &lt; m and B[j-1] &gt; A[i]:</span><br><span class="line">            # i is too small, must increase it</span><br><span class="line">            imin = i + 1</span><br><span class="line">        elif i &gt; 0 and A[i-1] &gt; B[j]:</span><br><span class="line">            # i is too big, must decrease it</span><br><span class="line">            imax = i - 1</span><br><span class="line">        else:</span><br><span class="line">            # i is perfect</span><br><span class="line"></span><br><span class="line">            if i == 0: max_of_left = B[j-1]</span><br><span class="line">            elif j == 0: max_of_left = A[i-1]</span><br><span class="line">            else: max_of_left = max(A[i-1], B[j-1])</span><br><span class="line"></span><br><span class="line">            if (m + n) % 2 == 1:</span><br><span class="line">                return max_of_left</span><br><span class="line"></span><br><span class="line">            if i == m: min_of_right = B[j]</span><br><span class="line">            elif j == n: min_of_right = A[i]</span><br><span class="line">            else: min_of_right = min(A[i], B[j])</span><br><span class="line"></span><br><span class="line">            return (max_of_left + min_of_right) / 2.0</span><br></pre></td></tr></table></figure>
<h1 id="常用数据处理库"><a href="#常用数据处理库" class="headerlink" title="常用数据处理库"></a>常用数据处理库</h1><h2 id="numpy"><a href="#numpy" class="headerlink" title="numpy"></a>numpy</h2><h3 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; x = np.array([1,2,3])</span><br><span class="line">&gt;&gt;&gt; y = np.array([4,5,6])</span><br><span class="line">&gt;&gt;&gt; np.concatenate([x,y],axis = 0)</span><br><span class="line">array([1, 2, 3, 4, 5, 6])</span><br><span class="line">&gt;&gt;&gt; np.vstack((x,y))</span><br><span class="line">array([[1, 2, 3],</span><br><span class="line">       [4, 5, 6]])</span><br><span class="line">&gt;&gt;&gt; np.hstack((x,y))</span><br><span class="line">array([1, 2, 3, 4, 5, 6])</span><br></pre></td></tr></table></figure>
<h2 id="pandas"><a href="#pandas" class="headerlink" title="pandas"></a>pandas</h2><pre><code>关键缩写和包导入
在这个速查手册中，我们使用如下缩写：

df：任意的Pandas DataFrame对象
s：任意的Pandas Series对象
同时我们需要做如下的引入：
</code></pre><p>​<br>    import pandas as pd<br>    import numpy as np</p>
<h3 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h3><ul>
<li>pd.read_csv(filename)：从CSV文件导入数据</li>
<li>pd.read_table(filename)：从限定分隔符的文本文件导入数据</li>
<li>pd.read_excel(filename)：从Excel文件导入数据</li>
<li>pd.read_sql(query, connection_object)：从SQL表/库导入数据</li>
<li>pd.read_json(json_string)：从JSON格式的字符串导入数据</li>
<li>pd.read_html(url)：解析URL、字符串或者HTML文件，抽取其中的tables表格</li>
<li>pd.read_clipboard()：从你的粘贴板获取内容，并传给read_table()</li>
<li>pd.DataFrame(dict)：从字典对象导入数据，Key是列名，Value是数据</li>
</ul>
<h3 id="导出数据"><a href="#导出数据" class="headerlink" title="导出数据"></a>导出数据</h3><ul>
<li>df.to_csv(filename)：导出数据到CSV文件</li>
<li>df.to_excel(filename)：导出数据到Excel文件</li>
<li>df.to_sql(table_name, connection_object)：导出数据到SQL表</li>
<li>df.to_json(filename)：以Json格式导出数据到文本文件</li>
</ul>
<h3 id="创建测试对象"><a href="#创建测试对象" class="headerlink" title="创建测试对象"></a>创建测试对象</h3><ul>
<li>pd.DataFrame(np.random.rand(20,5))：创建20行5列的随机数组成的DataFrame对象</li>
<li>pd.Series(my_list)：从可迭代对象my_list创建一个Series对象</li>
<li>df.index = pd.date_range(‘1900/1/30’, periods=df.shape[0])：增加一个日期索引</li>
</ul>
<h3 id="查看、检查数据"><a href="#查看、检查数据" class="headerlink" title="查看、检查数据"></a>查看、检查数据</h3><ul>
<li>df.head(n)：查看DataFrame对象的前n行</li>
<li>df.tail(n)：查看DataFrame对象的最后n行</li>
<li>df.shape()：查看行数和列数</li>
<li>df.info()：查看索引、数据类型和内存信息</li>
<li>df.describe()：查看数值型列的汇总统计</li>
<li>s.value_counts(dropna=False)：查看Series对象的唯一值和计数</li>
<li>df.apply(pd.Series.value_counts)：查看DataFrame对象中每一列的唯一值和计数</li>
</ul>
<h3 id="数据选取"><a href="#数据选取" class="headerlink" title="数据选取"></a>数据选取</h3><ul>
<li>df[col]：根据列名，并以Series的形式返回列</li>
<li>df[[col1, col2]]：以DataFrame形式返回多列</li>
<li>s.iloc[0]：按位置选取数据</li>
<li>s.loc[‘index_one’]：按索引选取数据</li>
<li>df.iloc[0,:]：返回第一行</li>
<li>df.iloc[0,0]：返回第一列的第一个元素</li>
<li>df.sample(n=None, frac=None, replace=False, weights=None, random_state=None, axis=None)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">n是要抽取的行数。（例如n=20000时，抽取其中的2W行）</span><br><span class="line"></span><br><span class="line">frac是抽取的比列。（有一些时候，我们并对具体抽取的行数不关系，我们想抽取其中的百分比，这个时候就可以选择使用frac，例如frac=0.8，就是抽取其中80%）</span><br><span class="line"></span><br><span class="line">replace抽样后的数据是否代替原DataFrame()</span><br><span class="line"></span><br><span class="line">weights这个是每个样本的权重，具体可以看官方文档说明。</span><br><span class="line"></span><br><span class="line">random_state这个在之前的文章已经介绍过了。</span><br><span class="line"></span><br><span class="line">axis是选择抽取数据的行还是列。axis=0的时是抽取行，axis=1时是抽取列（也就是说axis=1时，在列中随机抽取n列，在axis=0时，在行中随机抽取n行）</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="数据清理"><a href="#数据清理" class="headerlink" title="数据清理"></a>数据清理</h3><ul>
<li>df.columns = [‘a’,’b’,’c’]：重命名列名</li>
<li>pd.isnull()：检查DataFrame对象中的空值，并返回一个Boolean数组</li>
<li>pd.notnull()：检查DataFrame对象中的非空值，并返回一个Boolean数组</li>
<li>df.dropna()：删除所有包含空值的行</li>
<li>df.dropna(axis=1)：删除所有包含空值的列</li>
<li>df.dropna(axis=1,thresh=n)：删除所有小于n个非空值的行</li>
<li>df.fillna(x)：用x替换DataFrame对象中所有的空值</li>
<li>s.astype(float)：将Series中的数据类型更改为float类型</li>
<li>s.replace(1,’one’)：用‘one’代替所有等于1的值</li>
<li>s.replace([1,3],[‘one’,’three’])：用’one’代替1，用’three’代替3</li>
<li>df.rename(columns=lambda x: x + 1)：批量更改列名</li>
<li>df.rename(columns={‘old_name’: ‘new_ name’})：选择性更改列名</li>
<li>df.set_index(‘column_one’)：更改索引列</li>
<li>df.rename(index=lambda x: x + 1)：批量重命名索引</li>
<li>df.drop(df,axis=…):删除行或列<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; df</span><br><span class="line">     A      B         C         D</span><br><span class="line">0  foo    one  0.016336  0.087302</span><br><span class="line">1  bar    one -0.394784 -2.609699</span><br><span class="line">2  foo    two -0.241163  0.429637</span><br><span class="line">3  bar  three -1.450263  1.574793</span><br><span class="line">4  foo    two -0.436486  0.047045</span><br><span class="line">5  bar    two  0.378663 -0.596585</span><br><span class="line">6  foo    one  0.576077  0.036312</span><br><span class="line">7  foo  three -1.507273  0.212231</span><br><span class="line">&gt;&gt;&gt; df.drop(&apos;A&apos;,axis = 1)</span><br><span class="line">       B         C         D</span><br><span class="line">0    one  0.016336  0.087302</span><br><span class="line">1    one -0.394784 -2.609699</span><br><span class="line">2    two -0.241163  0.429637</span><br><span class="line">3  three -1.450263  1.574793</span><br><span class="line">4    two -0.436486  0.047045</span><br><span class="line">5    two  0.378663 -0.596585</span><br><span class="line">6    one  0.576077  0.036312</span><br><span class="line">7  three -1.507273  0.212231</span><br><span class="line">&gt;&gt;&gt; df.drop([&apos;A&apos;,&apos;B&apos;],axis = 1)</span><br><span class="line">          C         D</span><br><span class="line">0  0.016336  0.087302</span><br><span class="line">1 -0.394784 -2.609699</span><br><span class="line">2 -0.241163  0.429637</span><br><span class="line">3 -1.450263  1.574793</span><br><span class="line">4 -0.436486  0.047045</span><br><span class="line">5  0.378663 -0.596585</span><br><span class="line">6  0.576077  0.036312</span><br><span class="line">7 -1.507273  0.212231</span><br><span class="line">&gt;&gt;&gt; df.drop([1,2,4],axis = 0)</span><br><span class="line">     A      B         C         D</span><br><span class="line">0  foo    one  0.016336  0.087302</span><br><span class="line">3  bar  three -1.450263  1.574793</span><br><span class="line">5  bar    two  0.378663 -0.596585</span><br><span class="line">6  foo    one  0.576077  0.036312</span><br><span class="line">7  foo  three -1.507273  0.212231</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="数据处理：Filter、Sort和GroupBy"><a href="#数据处理：Filter、Sort和GroupBy" class="headerlink" title="数据处理：Filter、Sort和GroupBy"></a>数据处理：Filter、Sort和GroupBy</h3><ul>
<li>df[df[col] &gt; 0.5]：选择col列的值大于0.5的行</li>
<li>df.sort_values(col1)：按照列col1排序数据，默认升序排列</li>
<li>df.sort_values(col2, ascending=False)：按照列col1降序排列数据</li>
<li>df.sort_values([col1,col2],ascending=[True,False])：先按列col1升序排列，后按col2降序排列数据</li>
<li>df.groupby(col)：返回一个按列col进行分组的Groupby对象</li>
<li>df.groupby([col1,col2])：返回一个按多列进行分组的Groupby对象</li>
<li>df.groupby(col1)[col2]：返回按列col1进行分组后，列col2的均值</li>
<li>df.pivot_table(index=col1,values=[col2,col3],aggfunc=max)：创建一个按列col1进行分组，并计算col2和col3的最大值的数据透视表</li>
<li>df.groupby(col1).agg(np.mean)：返回按列col1分组的所有列的均值</li>
<li>data.apply(np.mean)：对DataFrame中的每一列应用函数np.mean</li>
<li>data.apply(np.max,axis=1)：对DataFrame中的每一行应用函数np.max<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">#同一属性先移动到同一行，在做差</span><br><span class="line">df = pd.DataFrame(&#123;&apos;A&apos; : [&apos;foo&apos;, &apos;bar&apos;, &apos;foo&apos;, &apos;bar&apos;,&apos;foo&apos;, &apos;bar&apos;, &apos;foo&apos;, &apos;foo&apos;],</span><br><span class="line">&apos;B&apos; : [&apos;one&apos;, &apos;one&apos;, &apos;two&apos;, &apos;three&apos;,&apos;two&apos;, &apos;two&apos;, &apos;one&apos;, &apos;three&apos;],</span><br><span class="line">&apos;C&apos; : np.random.randn(8),</span><br><span class="line">&apos;D&apos; : np.random.randn(8)&#125;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; df</span><br><span class="line">     A      B         C         D         E</span><br><span class="line">0  foo    one -0.660824  0.758762  0.097938</span><br><span class="line">1  bar    one  1.673826 -0.369888  1.303938</span><br><span class="line">2  foo    two  1.151669  0.750455  1.902124</span><br><span class="line">3  bar  three -0.902216 -0.344720 -1.246936</span><br><span class="line">4  foo    two -0.232781 -1.256137 -1.488918</span><br><span class="line">5  bar    two  0.387244 -0.671663 -0.284419</span><br><span class="line">6  foo    one -1.199822  0.078424 -1.121398</span><br><span class="line">7  foo  three -0.404454  0.271658 -0.132796</span><br><span class="line">&gt;&gt;&gt; df[&apos;shift&apos;] = df.groupby(&apos;A&apos;)[&apos;C&apos;].apply(lambda i:i.shift(1))</span><br><span class="line">&gt;&gt;&gt; df</span><br><span class="line">     A      B         C         D         E     shift</span><br><span class="line">0  foo    one -0.660824  0.758762  0.097938       NaN</span><br><span class="line">1  bar    one  1.673826 -0.369888  1.303938       NaN</span><br><span class="line">2  foo    two  1.151669  0.750455  1.902124 -0.660824</span><br><span class="line">3  bar  three -0.902216 -0.344720 -1.246936  1.673826</span><br><span class="line">4  foo    two -0.232781 -1.256137 -1.488918  1.151669</span><br><span class="line">5  bar    two  0.387244 -0.671663 -0.284419 -0.902216</span><br><span class="line">6  foo    one -1.199822  0.078424 -1.121398 -0.232781</span><br><span class="line">7  foo  three -0.404454  0.271658 -0.132796 -1.199822</span><br><span class="line">&gt;&gt;&gt; df[&apos;diff&apos;] = df[&apos;C&apos;] - df[&apos;shift&apos;]</span><br><span class="line">&gt;&gt;&gt; df</span><br><span class="line">     A      B         C         D         E     shift      diff</span><br><span class="line">0  foo    one -0.660824  0.758762  0.097938       NaN       NaN</span><br><span class="line">1  bar    one  1.673826 -0.369888  1.303938       NaN       NaN</span><br><span class="line">2  foo    two  1.151669  0.750455  1.902124 -0.660824  1.812493</span><br><span class="line">3  bar  three -0.902216 -0.344720 -1.246936  1.673826 -2.576042</span><br><span class="line">4  foo    two -0.232781 -1.256137 -1.488918  1.151669 -1.384450</span><br><span class="line">5  bar    two  0.387244 -0.671663 -0.284419 -0.902216  1.289460</span><br><span class="line"></span><br><span class="line">#求A&apos;A&apos;中同一个元素对应的几个 &apos;C&apos;的 去量纲化</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; df[&apos;shift&apos;] = df.groupby(&apos;A&apos;)[&apos;C&apos;].apply(lambda i:(i-i.min())/i.std())</span><br><span class="line">#错了，对的df[&apos;shift&apos;] = df.groupby(&apos;A&apos;)[&apos;C&apos;].apply(lambda i:(i-i.mean())/i.std())</span><br><span class="line">&gt;&gt;&gt; df</span><br><span class="line">     A      B         C         D         E     shift      diff</span><br><span class="line">0  foo    one -0.660824  0.758762  0.097938  0.616460       NaN</span><br><span class="line">1  bar    one  1.673826 -0.369888  1.303938  2.000000       NaN</span><br><span class="line">2  foo    two  1.151669  0.750455  1.902124  2.689432  1.812493</span><br><span class="line">3  bar  three -0.902216 -0.344720 -1.246936  0.000000 -2.576042</span><br><span class="line">4  foo    two -0.232781 -1.256137 -1.488918  1.106018 -1.384450</span><br><span class="line">5  bar    two  0.387244 -0.671663 -0.284419  1.001117  1.289460</span><br><span class="line">6  foo    one -1.199822  0.078424 -1.121398  0.000000 -0.967042</span><br><span class="line">7  foo  three -0.404454  0.271658 -0.132796  0.909673  0.795368</span><br><span class="line"></span><br><span class="line">#概率计算</span><br><span class="line">&gt;&gt;&gt; rating_A = f.groupby(&apos;A&apos;).size().div(len(f))</span><br><span class="line">&gt;&gt;&gt; rating_A</span><br><span class="line">A</span><br><span class="line">bar    0.375</span><br><span class="line">foo    0.625</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">#条件概率</span><br><span class="line">&gt;&gt;&gt; f.groupby([&apos;A&apos;, &apos;B&apos;]).size().div(len(f)).div(rating_A, axis=0, level=&apos;A&apos;)</span><br><span class="line">A    B</span><br><span class="line">bar  one      0.333333</span><br><span class="line">     three    0.333333</span><br><span class="line">     two      0.333333</span><br><span class="line">foo  one      0.400000</span><br><span class="line">     three    0.200000</span><br><span class="line">     two      0.400000</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="数据合并"><a href="#数据合并" class="headerlink" title="数据合并"></a>数据合并</h3><ul>
<li>df1.append(df2)：将df2中的行添加到df1的尾部</li>
<li>df.concat([df1, df2],axis=1)：将df2中的列添加到df1的尾部</li>
<li>df1.join(df2,on=col1,how=’inner’)：对df1的列和df2的列执行SQL形式的join</li>
</ul>
<h3 id="数据统计"><a href="#数据统计" class="headerlink" title="数据统计"></a>数据统计</h3><ul>
<li>df.describe()：查看数据值列的汇总统计</li>
<li>df.mean()：返回所有列的均值</li>
<li>df.corr()：返回列与列之间的相关系数</li>
<li>df.count()：返回每一列中的非空值的个数</li>
<li>df.max()：返回每一列的最大值</li>
<li>df.min()：返回每一列的最小值</li>
<li>df.median()：返回每一列的中位数</li>
<li>df.std()：返回每一列的标准差<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pd.factorize() #标签映射为数字</span><br><span class="line">&gt;&gt;&gt; df = pd.DataFrame(&#123;&quot;id&quot;:[1,2,3,4,5,6,3,2], &quot;raw_grade&quot;:[&apos;a&apos;, &apos;b&apos;, &apos;b&apos;,&apos;a&apos;, &apos;a&apos;,&apos;e&apos;,&apos;c&apos;,&apos;a&apos;]&#125;)</span><br><span class="line">&gt;&gt;&gt; x,y = pd.factorize(df.raw_grade)</span><br><span class="line">&gt;&gt;&gt; x</span><br><span class="line">array([0, 1, 1, 0, 0, 2, 3, 0], dtype=int64)</span><br><span class="line">&gt;&gt;&gt; y</span><br><span class="line">Index([&apos;a&apos;, &apos;b&apos;, &apos;e&apos;, &apos;c&apos;], dtype=&apos;object&apos;)</span><br><span class="line">&gt;&gt;&gt; pd.factorize(df.raw_grade)</span><br><span class="line">(array([0, 1, 1, 0, 0, 2, 3, 0], dtype=int64), Index([&apos;a&apos;, &apos;b&apos;, &apos;e&apos;, &apos;c&apos;], dtype=&apos;object&apos;))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="多条件筛选"><a href="#多条件筛选" class="headerlink" title="多条件筛选"></a>多条件筛选</h3><p>在使用dataframe处理数据的时候碰到了按照条件选取行的问题，单个条件时可以使用：</p>
<p>df[df[‘one’] &gt; 5]</p>
<p>如果多个条件的话需要这么写：</p>
<p>import numpy as np</p>
<p>df[np.logical_and(df[‘one’]&gt; 5,df[‘two’]&gt;5)]</p>
<p>也可以这么写</p>
<p>df[(df[‘one’]&gt; 5) &amp; (df[‘two’]&gt;5)]</p>
<h3 id="数值优化来一波"><a href="#数值优化来一波" class="headerlink" title="数值优化来一波"></a>数值优化来一波</h3><ul>
<li><p>数值变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">df_int = df_t.select_dtypes(include=[&apos;int&apos;])</span><br><span class="line">df_t[df_int.columns] = df_int.apply(pd.to_numeric, downcast=&apos;unsigned&apos;)</span><br><span class="line"></span><br><span class="line">df_float = df_t.select_dtypes(include=[&apos;int&apos;])</span><br><span class="line">df_t[df_int.columns] = df_float.apply(pd.to_numeric, downcast=&apos;float&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>object变量</p>
</li>
</ul>
<ol>
<li>可以使用 one_hot</li>
<li>可以使用 categoricals<br>其实都一样啦</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#大佬的方法</span><br><span class="line">def one_hot_encoder(df, nan_as_category=True):</span><br><span class="line">    original_columns = list(df.columns)</span><br><span class="line">    categorical_columns = [col for col in df.columns if df[col].dtype == &apos;object&apos;]</span><br><span class="line">    df = pd.get_dummies(df, columns=categorical_columns, dummy_na=nan_as_category)</span><br><span class="line">    new_columns = [c for c in df.columns if c not in original_columns]</span><br><span class="line">    return df, new_columns</span><br></pre></td></tr></table></figure>
<h1 id="python工具类插件"><a href="#python工具类插件" class="headerlink" title="python工具类插件"></a>python工具类插件</h1><h2 id="itertools"><a href="#itertools" class="headerlink" title="itertools"></a>itertools</h2><p>迭代器的特点是：惰性求值（Lazy evaluation），即只有当迭代至某个值时，它才会被计算，这个特点使得迭代器特别适合于遍历大文件或无限集合等，因为我们不用一次性将它们存储在内存中。</p>
<p>Python 内置的 itertools 模块包含了一系列用来产生不同类型迭代器的函数或类，这些函数的返回都是一个迭代器，我们可以通过 for 循环来遍历取值，也可以使用 next() 来取值。</p>
<p>itertools 模块提供的迭代器函数有以下几种类型：</p>
<ul>
<li>无限迭代器：生成一个无限序列，比如自然数序列 1, 2, 3, 4, …；</li>
<li>有限迭代器：接收一个或多个序列（sequence）作为参数，进行组合、分组和过滤等；</li>
<li>组合生成器：序列的排列、组合，求序列的笛卡儿积等；</li>
</ul>
<h3 id="无限迭代器"><a href="#无限迭代器" class="headerlink" title="无限迭代器"></a>无限迭代器</h3><h4 id="count-firstval-0-step-1"><a href="#count-firstval-0-step-1" class="headerlink" title="count(firstval=0, step=1)"></a>count(firstval=0, step=1)</h4><p>创建一个从 firstval (默认值为 0) 开始，以 step (默认值为 1) 为步长的的无限整数迭代器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; nums = itertools.count(10, 2)    # 指定开始值和步长</span><br><span class="line">&gt;&gt;&gt; for i in nums:</span><br><span class="line">...     if i &gt; 20:</span><br><span class="line">...         break</span><br><span class="line">...     print i</span><br><span class="line">...</span><br><span class="line">10</span><br><span class="line">12</span><br><span class="line">14</span><br><span class="line">16</span><br><span class="line">18</span><br><span class="line">20</span><br></pre></td></tr></table></figure>
<h4 id="cycle-iterable"><a href="#cycle-iterable" class="headerlink" title="cycle(iterable)"></a>cycle(iterable)</h4><p>对 iterable 中的元素反复执行循环，返回迭代器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; cycle_strings = itertools.cycle(&apos;ABC&apos;)</span><br><span class="line">&gt;&gt;&gt; i = 1</span><br><span class="line">&gt;&gt;&gt; for string in cycle_strings:</span><br><span class="line">...     if i == 10:</span><br><span class="line">...         break</span><br><span class="line">...     print i, string</span><br><span class="line">...     i += 1</span><br><span class="line">...</span><br><span class="line">1 A</span><br><span class="line">2 B</span><br><span class="line">3 C</span><br><span class="line">4 A</span><br><span class="line">5 B</span><br><span class="line">6 C</span><br><span class="line">7 A</span><br><span class="line">8 B</span><br><span class="line">9 C</span><br></pre></td></tr></table></figure>
<h4 id="repeat-object-times"><a href="#repeat-object-times" class="headerlink" title="repeat(object [,times]"></a>repeat(object [,times]</h4><p>反复生成 object，如果给定 times，则重复次数为 times，否则为无限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; for item in itertools.repeat(&apos;hello world&apos;, 3):</span><br><span class="line">...     print item</span><br><span class="line">...</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; for item in itertools.repeat([1, 2, 3, 4], 3):</span><br><span class="line">...     print item</span><br><span class="line">...</span><br><span class="line">[1, 2, 3, 4]</span><br><span class="line">[1, 2, 3, 4]</span><br><span class="line">[1, 2, 3, 4]</span><br></pre></td></tr></table></figure>
<h3 id="有限迭代器"><a href="#有限迭代器" class="headerlink" title="有限迭代器"></a>有限迭代器</h3><p>itertools 模块提供了多个函数（类），接收一个或多个迭代对象作为参数，对它们进行组合、分组和过滤等：</p>
<h4 id="chain-iterable1-iterable2-iterable3-…"><a href="#chain-iterable1-iterable2-iterable3-…" class="headerlink" title="chain(iterable1, iterable2, iterable3, …)"></a>chain(iterable1, iterable2, iterable3, …)</h4><pre><code>chain 接收多个可迭代对象作为参数，将它们『连接』起来，作为一个新的迭代器返回。
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; for item in chain([1, 2, 3], [&apos;a&apos;, &apos;b&apos;, &apos;c&apos;]):</span><br><span class="line">...     print item</span><br><span class="line">...</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br></pre></td></tr></table></figure>
<p>chain 还有一个常见的用法：</p>
<p>chain.from_iterable(iterable)<br>接收一个可迭代对象作为参数，返回一个迭代器：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from itertools import chain</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; string = chain.from_iterable(&apos;ABCD&apos;)</span><br><span class="line">&gt;&gt;&gt; string.next()</span><br><span class="line">&apos;A&apos;</span><br></pre></td></tr></table></figure></p>
<h4 id="compress-data-selectors"><a href="#compress-data-selectors" class="headerlink" title="compress(data, selectors)"></a>compress(data, selectors)</h4><p>compress 可用于对数据进行筛选，当 selectors 的某个元素为 true 时，则保留 data 对应位置的元素，否则去除：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">list(compress(&apos;ABCDEF&apos;, [1, 1, 0, 1, 0, 1]))</span><br><span class="line">[&apos;A&apos;, &apos;B&apos;, &apos;D&apos;, &apos;F&apos;]</span><br></pre></td></tr></table></figure></p>
<h4 id="dropwhile-predicate-iterable"><a href="#dropwhile-predicate-iterable" class="headerlink" title="dropwhile(predicate, iterable)"></a>dropwhile(predicate, iterable)</h4><p>其中，predicate 是函数，iterable 是可迭代对象。对于 iterable 中的元素，如果 predicate(item) 为 true，则丢弃该元素，否则返回该项及所有后续项<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">list(dropwhile(lambda x: x &lt; 5, [1, 3, 6, 2, 1]))</span><br><span class="line">[6, 2, 1]</span><br></pre></td></tr></table></figure></p>
<h4 id="groupby-iterable-keyfunc"><a href="#groupby-iterable-keyfunc" class="headerlink" title="groupby(iterable[, keyfunc])"></a>groupby(iterable[, keyfunc])</h4><p>其中，iterable 是一个可迭代对象，keyfunc 是分组函数，用于对 iterable 的连续项进行分组，如果不指定，则默认对 iterable 中的连续相同项进行分组，返回一个 (key, sub-iterator) 的迭代器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; data = [&apos;a&apos;, &apos;bb&apos;, &apos;ccc&apos;, &apos;dd&apos;, &apos;eee&apos;, &apos;f&apos;]</span><br><span class="line">&gt;&gt;&gt; for key,value_iter in groupby(data,len):</span><br><span class="line">...     print(key,&apos;:&apos;,list(value_iter))</span><br><span class="line">...</span><br><span class="line">1 : [&apos;a&apos;]</span><br><span class="line">2 : [&apos;bb&apos;]</span><br><span class="line">3 : [&apos;ccc&apos;]</span><br><span class="line">2 : [&apos;dd&apos;]</span><br><span class="line">3 : [&apos;eee&apos;]</span><br><span class="line">1 : [&apos;f&apos;]</span><br><span class="line">&gt;&gt;&gt; data = [&apos;a&apos;, &apos;bb&apos;, &apos;cc&apos;, &apos;ddd&apos;, &apos;eee&apos;, &apos;f&apos;]</span><br><span class="line">&gt;&gt;&gt; for key,value_iter in groupby(data,len):</span><br><span class="line">...     print(key,&apos;:&apos;,list(value_iter))</span><br><span class="line">...</span><br><span class="line">1 : [&apos;a&apos;]</span><br><span class="line">2 : [&apos;bb&apos;, &apos;cc&apos;]</span><br><span class="line">3 : [&apos;ddd&apos;, &apos;eee&apos;]</span><br><span class="line">1 : [&apos;f&apos;]</span><br></pre></td></tr></table></figure></p>
<h4 id="ifilter-function-or-None-sequence"><a href="#ifilter-function-or-None-sequence" class="headerlink" title="ifilter(function or None, sequence)"></a>ifilter(function or None, sequence)</h4><p>将 iterable 中 function(item) 为 True 的元素组成一个迭代器返回，如果 function 是 None，则返回 iterable 中所有计算为 True 的项<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; list(ifilter(lambda x: x &lt; 6, range(10)))</span><br><span class="line">[0, 1, 2, 3, 4, 5]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; list(ifilter(None, [0, 1, 2, 0, 3, 4]))</span><br><span class="line">[1, 2, 3, 4]</span><br></pre></td></tr></table></figure></p>
<h4 id="ifilterfalse"><a href="#ifilterfalse" class="headerlink" title="ifilterfalse()"></a>ifilterfalse()</h4><p>和ifilter()类似，看名字也可以看出来了，相反嘛</p>
<h4 id="islice-iterable-start-stop-step"><a href="#islice-iterable-start-stop-step" class="headerlink" title="islice(iterable, [start,] stop [, step])"></a>islice(iterable, [start,] stop [, step])</h4><p>其中，iterable 是可迭代对象，start 是开始索引，stop 是结束索引，step 是步长，start 和 step 可选<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; list(islice([10, 6, 2, 8, 1, 3, 9], 5))</span><br><span class="line">[10, 6, 2, 8, 1]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; list(islice(count(), 6))</span><br><span class="line">[0, 1, 2, 3, 4, 5]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; list(islice(count(), 3, 10))</span><br><span class="line">[3, 4, 5, 6, 7, 8, 9]</span><br><span class="line">&gt;&gt;&gt; list(islice(count(), 3, 10 ,2))</span><br><span class="line">[3, 5, 7, 9]</span><br></pre></td></tr></table></figure></p>
<h4 id="imap"><a href="#imap" class="headerlink" title="imap()"></a>imap()</h4><p>imap(func, iter1, iter2, iter3, …)<br>imap 返回一个迭代器，元素为 func(i1, i2, i3, …)，i1，i2 等分别来源于 iter, iter2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; imap(str, [1, 2, 3, 4])</span><br><span class="line">&lt;itertools.imap object at 0x10556d050&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; list(imap(str, [1, 2, 3, 4]))</span><br><span class="line">[&apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; list(imap(pow, [2, 3, 10], [4, 2, 3]))</span><br><span class="line">[16, 9, 1000]</span><br></pre></td></tr></table></figure></p>
<h4 id="starmap"><a href="#starmap" class="headerlink" title="starmap()"></a>starmap()</h4><h4 id="tee"><a href="#tee" class="headerlink" title="tee()"></a>tee()</h4><p>tee(iterable [,n])<br>tee 用于从 iterable 创建 n 个独立的迭代器，以元组的形式返回，n 的默认值是 2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; tee(&apos;abcd&apos;)   # n 默认为 2，创建两个独立的迭代器</span><br><span class="line">(&lt;itertools.tee object at 0x1049957e8&gt;, &lt;itertools.tee object at 0x104995878&gt;)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; iter1, iter2 = tee(&apos;abcde&apos;)</span><br><span class="line">&gt;&gt;&gt; list(iter1)</span><br><span class="line">[&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos;]</span><br><span class="line">&gt;&gt;&gt; list(iter2)</span><br><span class="line">[&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos;]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; tee(&apos;abc&apos;, 3)  # 创建三个独立的迭代器</span><br><span class="line">(&lt;itertools.tee object at 0x104995998&gt;, &lt;itertools.tee object at 0x1049959e0&gt;, &lt;itertools.tee object at 0x104995a28&gt;)</span><br></pre></td></tr></table></figure></p>
<h4 id="takewhile"><a href="#takewhile" class="headerlink" title="takewhile()"></a>takewhile()</h4><p>takewhile(predicate, iterable)<br>其中，predicate 是函数，iterable 是可迭代对象。对于 iterable 中的元素，如果 predicate(item) 为 true，则保留该元素，只要 predicate(item) 为 false，则立即停止迭代<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; list(takewhile(lambda x: x &lt; 5, [1, 3, 6, 2, 1]))</span><br><span class="line">[1, 3]</span><br><span class="line">&gt;&gt;&gt; list(takewhile(lambda x: x &gt; 3, [2, 1, 6, 5, 4]))</span><br><span class="line">[]</span><br></pre></td></tr></table></figure></p>
<h4 id="izip"><a href="#izip" class="headerlink" title="izip()"></a>izip()</h4><p>izip(iter1, iter2, …, iterN)<br>如果某个可迭代对象不再生成值，则迭代停止<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; for item in izip(&apos;ABCD&apos;, &apos;xy&apos;):</span><br><span class="line">...     print item</span><br><span class="line">...</span><br><span class="line">(&apos;A&apos;, &apos;x&apos;)</span><br><span class="line">(&apos;B&apos;, &apos;y&apos;)</span><br><span class="line">&gt;&gt;&gt; for item in izip([1, 2, 3], [&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos;]):</span><br><span class="line">...     print item</span><br><span class="line">...</span><br><span class="line">(1, &apos;a&apos;)</span><br><span class="line">(2, &apos;b&apos;)</span><br><span class="line">(3, &apos;c&apos;)</span><br></pre></td></tr></table></figure></p>
<h4 id="izip-longest"><a href="#izip-longest" class="headerlink" title="izip_longest()"></a>izip_longest()</h4><p>izip_longest(iter1, iter2, …, iterN, [fillvalue=None])<br>如果有指定 fillvalue，则会用其填充缺失的值，否则为 None<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; for item in izip_longest(&apos;ABCD&apos;, &apos;xy&apos;):</span><br><span class="line">...     print item</span><br><span class="line">...</span><br><span class="line">(&apos;A&apos;, &apos;x&apos;)</span><br><span class="line">(&apos;B&apos;, &apos;y&apos;)</span><br><span class="line">(&apos;C&apos;, None)</span><br><span class="line">(&apos;D&apos;, None)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; for item in izip_longest(&apos;ABCD&apos;, &apos;xy&apos;, fillvalue=&apos;-&apos;):</span><br><span class="line">...     print item</span><br><span class="line">...</span><br><span class="line">(&apos;A&apos;, &apos;x&apos;)</span><br><span class="line">(&apos;B&apos;, &apos;y&apos;)</span><br><span class="line">(&apos;C&apos;, &apos;-&apos;)</span><br><span class="line">(&apos;D&apos;, &apos;-&apos;)</span><br></pre></td></tr></table></figure></p>
<h3 id="组合生成器"><a href="#组合生成器" class="headerlink" title="组合生成器"></a>组合生成器</h3><p>itertools 模块还提供了多个组合生成器函数，用于求序列的排列、组合等：</p>
<ul>
<li>product</li>
<li>permutations</li>
<li>combinations</li>
<li>combinations_with_replacement<h4 id="product-iter1-iter2-…-iterN-repeat-1"><a href="#product-iter1-iter2-…-iterN-repeat-1" class="headerlink" title="product(iter1, iter2, … iterN, [repeat=1])"></a>product(iter1, iter2, … iterN, [repeat=1])</h4>其中，repeat 是一个关键字参数，用于指定重复生成序列的次数<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; for item in product(&apos;ABCD&apos;, &apos;xy&apos;):</span><br><span class="line">...     print item</span><br><span class="line">...</span><br><span class="line">(&apos;A&apos;, &apos;x&apos;)</span><br><span class="line">(&apos;A&apos;, &apos;y&apos;)</span><br><span class="line">(&apos;B&apos;, &apos;x&apos;)</span><br><span class="line">(&apos;B&apos;, &apos;y&apos;)</span><br><span class="line">(&apos;C&apos;, &apos;x&apos;)</span><br><span class="line">(&apos;C&apos;, &apos;y&apos;)</span><br><span class="line">(&apos;D&apos;, &apos;x&apos;)</span><br><span class="line">(&apos;D&apos;, &apos;y&apos;)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; list(product(&apos;ab&apos;, range(3)))</span><br><span class="line">[(&apos;a&apos;, 0), (&apos;a&apos;, 1), (&apos;a&apos;, 2), (&apos;b&apos;, 0), (&apos;b&apos;, 1), (&apos;b&apos;, 2)]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; list(product((0,1), (0,1), (0,1)))</span><br><span class="line">[(0, 0, 0), (0, 0, 1), (0, 1, 0), (0, 1, 1), (1, 0, 0), (1, 0, 1), (1, 1, 0), (1, 1, 1)]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; list(product(&apos;ABC&apos;, repeat=2))</span><br><span class="line">[(&apos;A&apos;, &apos;A&apos;), (&apos;A&apos;, &apos;B&apos;), (&apos;A&apos;, &apos;C&apos;), (&apos;B&apos;, &apos;A&apos;), (&apos;B&apos;, &apos;B&apos;), (&apos;B&apos;, &apos;C&apos;), (&apos;C&apos;, &apos;A&apos;), (&apos;C&apos;, &apos;B&apos;), (&apos;C&apos;, &apos;C&apos;)]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="permutations-iterable-r"><a href="#permutations-iterable-r" class="headerlink" title="permutations(iterable[, r])"></a>permutations(iterable[, r])</h4><p>其中，r 指定生成排列的元素的长度，如果不指定，则默认为可迭代对象的元素长度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; permutations(&apos;ABC&apos;, 2)</span><br><span class="line">&lt;itertools.permutations object at 0x1074d9c50&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; list(permutations(&apos;ABC&apos;, 2))</span><br><span class="line">[(&apos;A&apos;, &apos;B&apos;), (&apos;A&apos;, &apos;C&apos;), (&apos;B&apos;, &apos;A&apos;), (&apos;B&apos;, &apos;C&apos;), (&apos;C&apos;, &apos;A&apos;), (&apos;C&apos;, &apos;B&apos;)]</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; list(permutations(&apos;ABC&apos;))</span><br><span class="line">[(&apos;A&apos;, &apos;B&apos;, &apos;C&apos;), (&apos;A&apos;, &apos;C&apos;, &apos;B&apos;), (&apos;B&apos;, &apos;A&apos;, &apos;C&apos;), (&apos;B&apos;, &apos;C&apos;, &apos;A&apos;), (&apos;C&apos;, &apos;A&apos;, &apos;B&apos;), (&apos;C&apos;, &apos;B&apos;, &apos;A&apos;)]</span><br></pre></td></tr></table></figure></p>
<h4 id="combinations-iterable-r"><a href="#combinations-iterable-r" class="headerlink" title="combinations(iterable, r)"></a>combinations(iterable, r)</h4><p>其中，r 指定生成组合的元素的长度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; list(combinations(&apos;ABC&apos;, 2))</span><br><span class="line">[(&apos;A&apos;, &apos;B&apos;), (&apos;A&apos;, &apos;C&apos;), (&apos;B&apos;, &apos;C&apos;)]</span><br></pre></td></tr></table></figure></p>
<h2 id="click"><a href="#click" class="headerlink" title="click"></a>click</h2><p>click为命令行工具的开发封装了大量的方法，下面简单学习一下。详细使用还要开官方文档。</p>
<ul>
<li><p>程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># hello.py</span><br><span class="line">import click</span><br><span class="line"></span><br><span class="line">@click.command()</span><br><span class="line">@click.option(&apos;--count&apos;, default=1, help=&apos;Number of greetings.&apos;)</span><br><span class="line">@click.option(&apos;--name&apos;, prompt=&apos;Your name&apos;,help=&apos;The person to greet.&apos;)</span><br><span class="line">def hello(count, name):</span><br><span class="line">    for x in range(count):</span><br><span class="line">        click.echo(&apos;Hello %s!&apos; % name)</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    hello()</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS G:\test&gt; python .\hello.py</span><br><span class="line">Your name: a</span><br><span class="line">Hello a!</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>相当于click将原来的函数封装了，可以使用输入参数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PS G:\test&gt; python .\hello.py --help</span><br><span class="line">Usage: hello.py [OPTIONS]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --count INTEGER  Number of greetings.</span><br><span class="line">  --name TEXT      The person to greet.</span><br><span class="line">  --help           Show this message and exit.</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>click.group()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@click.group()</span><br><span class="line">def cli():</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">@click.command()</span><br><span class="line">def initdb():</span><br><span class="line">    click.echo(&apos;Initialized the database&apos;)</span><br><span class="line"></span><br><span class="line">@click.command()</span><br><span class="line">def dropdb():</span><br><span class="line">    click.echo(&apos;Dropped the database&apos;)</span><br><span class="line"></span><br><span class="line">cli.add_command(initdb)</span><br><span class="line">cli.add_command(dropdb)</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行<br>秒变子命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PS G:\test&gt; python .\hello.py</span><br><span class="line">Usage: hello.py [OPTIONS] COMMAND [ARGS]...</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --help  Show this message and exit.</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  dropdb</span><br><span class="line">  initdb</span><br><span class="line">PS G:\test&gt; python hello.py initdb</span><br><span class="line">Initialized the database</span><br></pre></td></tr></table></figure>
</li>
<li><p>Group.command()<br>直接关联，如上面程序的升级版就是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import click</span><br><span class="line">@click.group()</span><br><span class="line">def cli():</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">@cli.command()</span><br><span class="line">def initdb():</span><br><span class="line">    click.echo(&apos;Initialized the database&apos;)</span><br><span class="line"></span><br><span class="line">@cli.command()</span><br><span class="line">def dropdb():</span><br><span class="line">    click.echo(&apos;Dropped the database&apos;)</span><br><span class="line"></span><br><span class="line">cli()</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PS G:\test&gt; python .\hello.py</span><br><span class="line">Usage: hello.py [OPTIONS] COMMAND [ARGS]...</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --help  Show this message and exit.</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  dropdb</span><br><span class="line">  initdb</span><br><span class="line">PS G:\test&gt; python .\hello.py initdb</span><br><span class="line">Initialized the database</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="yaml-pickle"><a href="#yaml-pickle" class="headerlink" title="yaml(pickle)"></a>yaml(pickle)</h2><p>加载yaml文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import yaml</span><br><span class="line">&gt;&gt;&gt; f = open(&apos;test.yml&apos;)</span><br><span class="line">&gt;&gt;&gt; f</span><br><span class="line">&lt;_io.TextIOWrapper name=&apos;test.yml&apos; mode=&apos;r&apos; encoding=&apos;UTF-8&apos;&gt;</span><br><span class="line">&gt;&gt;&gt; x = yaml.load(f)</span><br><span class="line">&gt;&gt;&gt; x</span><br><span class="line">&#123;&apos;name&apos;: &apos;Tom Smith&apos;, &apos;age&apos;: 37, &apos;spouse&apos;: &#123;&apos;name&apos;: &apos;Jane Smith&apos;, &apos;age&apos;: 25&#125;, &apos;children&apos;: [&#123;&apos;name&apos;: &apos;Jimmy Smith&apos;, &apos;age&apos;: 15&#125;, &#123;&apos;name1&apos;: &apos;Jenny Smith&apos;, &apos;age1&apos;: 12&#125;]&#125;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">name: Tom Smith  </span><br><span class="line">age: 37  </span><br><span class="line">spouse:  </span><br><span class="line">    name: Jane Smith  </span><br><span class="line">    age: 25  </span><br><span class="line">children:  </span><br><span class="line"> - name: Jimmy Smith  </span><br><span class="line">   age: 15  </span><br><span class="line"> - name1: Jenny Smith  </span><br><span class="line">   age1: 12</span><br></pre></td></tr></table></figure>
<h2 id="easydict"><a href="#easydict" class="headerlink" title="easydict"></a>easydict</h2><p>可以以属性的方式访问字典的值,和yaml一起使用效果更加，度配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import yaml</span><br><span class="line">&gt;&gt;&gt; from easydict import EasyDict as edict</span><br><span class="line">&gt;&gt;&gt; y = open(&apos;test.yml&apos;)</span><br><span class="line">&gt;&gt;&gt; x = yaml.load(y)</span><br><span class="line">&gt;&gt;&gt; x</span><br><span class="line">&#123;&apos;name&apos;: &apos;Tom Smith&apos;, &apos;age&apos;: 37, &apos;spouse&apos;: &#123;&apos;name&apos;: &apos;Jane Smith&apos;, &apos;age&apos;: 25&#125;, &apos;children&apos;: [&#123;&apos;name&apos;: &apos;Jimmy Smith&apos;, &apos;age&apos;: 15&#125;, &#123;&apos;name1&apos;: &apos;Jenny Smith&apos;, &apos;age1&apos;: 12&#125;]&#125;</span><br><span class="line">&gt;&gt;&gt; d = edict(x)</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">&#123;&apos;name&apos;: &apos;Tom Smith&apos;, &apos;age&apos;: 37, &apos;spouse&apos;: &#123;&apos;name&apos;: &apos;Jane Smith&apos;, &apos;age&apos;: 25&#125;, &apos;children&apos;: [&#123;&apos;name&apos;: &apos;Jimmy Smith&apos;, &apos;age&apos;: 15&#125;, &#123;&apos;name1&apos;: &apos;Jenny Smith&apos;, &apos;age1&apos;: 12&#125;]&#125;</span><br><span class="line">&gt;&gt;&gt; d.name</span><br><span class="line">&apos;Tom Smith&apos;</span><br><span class="line">&gt;&gt;&gt; x.name</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">AttributeError: &apos;dict&apos; object has no attribute &apos;name&apos;</span><br></pre></td></tr></table></figure></p>
<h1 id="常用数据库"><a href="#常用数据库" class="headerlink" title="常用数据库"></a>常用数据库</h1><h2 id="SQLite"><a href="#SQLite" class="headerlink" title="SQLite"></a>SQLite</h2><p>SQLite是一种嵌入式关系型数据库，它的数据库就是一个文件。Python 2.5x以上版本内置了SQLite3，使用时直接import sqlite3即可<br><a href="http://www.runoob.com/sqlite/sqlite-python.html" target="_blank" rel="noopener">教程</a></p>
<h3 id="操作流程"><a href="#操作流程" class="headerlink" title="操作流程"></a>操作流程</h3><h4 id="sqlite3-connect-database-timeout-…"><a href="#sqlite3-connect-database-timeout-…" class="headerlink" title="sqlite3.connect(database,[timeout,…])"></a>sqlite3.connect(database,[timeout,…])</h4><p>打开一个文件与SQLite连接，如果存在打开，不存在，创建。</p>
<h4 id="sqlite3-cursor"><a href="#sqlite3-cursor" class="headerlink" title="sqlite3.cursor()"></a>sqlite3.cursor()</h4><p>可以创建表</p>
<h4 id="增删改查都可以用-connect-execute-完成…"><a href="#增删改查都可以用-connect-execute-完成…" class="headerlink" title="增删改查都可以用 connect.execute()完成…"></a>增删改查都可以用 connect.execute()完成…</h4><h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><p>也是关系型数据库，和SQLite差不多，建立连接与光标对象，用execute()执行SQL语句，commit()提交事务，fetchall()获得查询结果</p>
<h2 id="LMDB"><a href="#LMDB" class="headerlink" title="LMDB"></a>LMDB</h2><p>属于key-value型(键值对，非关系型)数据库</p>
<h3 id="操作流程-1"><a href="#操作流程-1" class="headerlink" title="操作流程"></a>操作流程</h3><p>通过env = lmdb.open()打开环境<br>通过txn = env.begin()建立事务<br>通过txn.put(key, value)进行插入和修改<br>通过txn.delete(key)进行删除<br>通过txn.get(key)进行查询<br>通过txn.cursor()进行遍历<br>通过txn.commit()提交更改</p>
<h2 id="LevelDB"><a href="#LevelDB" class="headerlink" title="LevelDB"></a>LevelDB</h2><p>同为key-value数据库</p>
<h3 id="操作流程-2"><a href="#操作流程-2" class="headerlink" title="操作流程"></a>操作流程</h3><p>LevelDB操作时类似与LMDB，使用Put/Get/Delete，但是更加简单（不需要事务txn和commit提交），同时支持范围迭代器RangeIter。</p>
<p><strong>SQLite与MySQL都是关系型数据库，操作时创建连接对象connection与光标对象cursor，通过execute执行SQL语句，commit提交变更，fetch得到查询结果；LMDB与LevelDB都是K-V数据库，操作时建立与数据库的连接，用put/delete改变数据，用get获取数据，区别是LMDB中有事务需要commit，LevelDB不需要。</strong></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/14/OBject-Detection/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="田小默">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="田小默的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/05/14/OBject-Detection/" class="post-title-link" itemprop="url">OBject-Detection</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-05-14 16:23:19" itemprop="dateCreated datePublished" datetime="2018-05-14T16:23:19+08:00">2018-05-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-10-16 10:38:33" itemprop="dateModified" datetime="2018-10-16T10:38:33+08:00">2018-10-16</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h2 id="Object-Detection"><a href="#Object-Detection" class="headerlink" title="Object Detection:"></a><a href="https://blog.csdn.net/xyfengbo/article/details/70227173" target="_blank" rel="noopener">Object Detection:</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">RCNN --&gt; SPP_NET</span><br><span class="line">SPP_NET--&gt;Fast_RCNN</span><br><span class="line">Fast_RCNN--&gt;Faster_RCNN</span><br><span class="line">Faster_RCNN--&gt;Mask_RCNN</span><br></pre></td></tr></table></figure>
<h1 id="一、R-CNN"><a href="#一、R-CNN" class="headerlink" title="一、R-CNN"></a>一、<a href="https://blog.csdn.net/WoPawn/article/details/52133338" target="_blank" rel="noopener">R-CNN</a></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">image--&gt;Region_Proposal</span><br><span class="line">Region_Proposal--&gt;CNN</span><br><span class="line">CNN--&gt;SVM</span><br><span class="line">CNN--&gt;Regression</span><br><span class="line">Regression--&gt;CNN</span><br></pre></td></tr></table></figure>
<h3 id="1-候选框"><a href="#1-候选框" class="headerlink" title="1.候选框"></a>1.候选框</h3><p>使用Region Proposal算法选择区域，一般2k个候选区域</p>
<h3 id="2-CNN提取特征"><a href="#2-CNN提取特征" class="headerlink" title="2.CNN提取特征"></a>2.CNN提取特征</h3><p>一般使用AlexNet、VGG-16网络作为提取特征的CNN网络。先对网络进行预训练，使用ILVCR 2012作为数据集进行训练，输出为1000维的标签。与训练完后，将最后的分类层删除，4096维特征直接输入SVM进行分类。</p>
<h3 id="3-SVM分类器分类，打分，非极大值抑制"><a href="#3-SVM分类器分类，打分，非极大值抑制" class="headerlink" title="3. SVM分类器分类，打分，非极大值抑制"></a>3. SVM分类器分类，打分，非极大值抑制</h3><p>CNN提取的特征输入SVM，分类</p>
<h3 id="4-回归器finetune"><a href="#4-回归器finetune" class="headerlink" title="4.回归器finetune"></a>4.回归器finetune</h3><p>CNN提取的特征输入回归器Regression进行对网络FineTune.</p>
<h3 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h3><ol>
<li><p>多个候选区域对应的图像需要预先提取，占用较大的磁盘空间；</p>
</li>
<li><p>针对传统CNN需要固定尺寸的输入图像，crop/warp（归一化）产生物体截断或拉伸，会导致输入CNN的信息丢失；</p>
</li>
<li><p>每一个ProposalRegion都需要进入CNN网络计算，上千个Region存在大量的范围重叠，重复的特征提取带来巨大的计算浪费。</p>
</li>
</ol>
<hr>
<h1 id="二、SPP-NET"><a href="#二、SPP-NET" class="headerlink" title="二、SPP NET"></a>二、SPP NET</h1><p>Spatial Pyramid Pooling<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">image--&gt;CNN</span><br><span class="line">image--&gt;Region_Proposal</span><br><span class="line">CNN--&gt;Features</span><br><span class="line">Region_Proposal--&gt;Features</span><br><span class="line">Features--&gt;SPP</span><br><span class="line">SPP--&gt;FC</span><br><span class="line">FC--&gt;SVM</span><br><span class="line">FC--&gt;Regression</span><br></pre></td></tr></table></figure></p>
<h3 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h3><p>使用SPP特殊的pooling使得卷积计算大大减少</p>
<h3 id="1-候选框-1"><a href="#1-候选框-1" class="headerlink" title="1.候选框"></a>1.候选框</h3><p>和RCNN相同</p>
<h3 id="2-对整个图片做SPP-Net卷积"><a href="#2-对整个图片做SPP-Net卷积" class="headerlink" title="2.对整个图片做SPP_Net卷积"></a>2.对整个图片做SPP_Net卷积</h3><p>采用空间金字塔池化（SpatialPyramid Pooling ）替换了 全连接层之前的最后一个池化层（上图top）.</p>
<p>把整张待检测的图片，输入CNN中，进行一次性特征提取，得到feature maps，然后在feature maps中找到各个候选框的区域，再对各个候选框采用金字塔空间池化，提取出固定长度的特征向量。而R-CNN输入的是每个候选框，然后在进入CNN，因为SPP-Net只需要一次对整张图片进行特征提取，速度会大大提升。</p>
<h3 id="3-SVM"><a href="#3-SVM" class="headerlink" title="3.SVM"></a>3.SVM</h3><p>和RCNN相同</p>
<h3 id="4-Regression"><a href="#4-Regression" class="headerlink" title="4.Regression"></a>4.Regression</h3><p>和RCNN相同</p>
<h3 id="缺点：-1"><a href="#缺点：-1" class="headerlink" title="缺点："></a>缺点：</h3><p>1）和RCNN一样，训练过程仍然是隔离的，提取候选框 | 计算CNN特征| SVM分类 | Bounding Box回归独立训练，大量的中间结果需要转存，无法整体训练参数；</p>
<p>2）SPP-Net在无法同时Tuning在SPP-Layer两边的卷积层和全连接层，很大程度上限制了深度CNN的效果；</p>
<p>3）在整个过程中，Proposal Region仍然很耗时。</p>
<hr>
<h1 id="三、Fast-RCNN"><a href="#三、Fast-RCNN" class="headerlink" title="三、Fast-RCNN"></a>三、<a href="https://blog.csdn.net/shenxiaolu1984/article/details/51036677" target="_blank" rel="noopener">Fast-RCNN</a></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">image--&gt;CNN</span><br><span class="line">CNN--&gt;RIO_Pooling</span><br><span class="line">image--&gt;Region_Proposal</span><br><span class="line">RIO_Pooling--&gt;Features</span><br><span class="line">Region_Proposal--&gt;RIO_Pooling</span><br><span class="line">Features--&gt;SoftmaxLoss</span><br><span class="line">SoftmaxLoss--&gt;Loss</span><br><span class="line">Features--&gt;SmoothL1Loss</span><br><span class="line">SmoothL1Loss--&gt;Loss</span><br><span class="line">Loss--&gt;Features</span><br></pre></td></tr></table></figure>
<h3 id="改进-1"><a href="#改进-1" class="headerlink" title="改进"></a>改进</h3><p> 1）借鉴SPP思路，提出简化版的ROI池化层（注意，没用金字塔），同时加入了候选框映射功能，使得网络能够反向传播，解决了SPP的整体网络训练问题；</p>
<p>2）多任务Loss层</p>
<pre><code>A）SoftmaxLoss代替了SVM，证明了softmax比SVM更好的效果
B）SmoothL1Loss取代Bouding box回归。
</code></pre><p>将分类和边框回归进行合并（又一个开创性的思路），通过多任务Loss层进一步整合深度网络，统一了训练过程，从而提高了算法准确度。</p>
<p>3）全连接层通过SVD加速</p>
<p>4）结合上面的改进，模型训练时可对所有层进行更新，除了速度提升外（训练速度是SPP的3倍，测试速度10倍），得到了更好的检测效果</p>
<h3 id="1-候选框-2"><a href="#1-候选框-2" class="headerlink" title="1.候选框"></a>1.候选框</h3><p>同上</p>
<h3 id="2-特征提取"><a href="#2-特征提取" class="headerlink" title="2.特征提取"></a>2.特征提取</h3><p>整个图片CNN网络提取特征，取出候选框中的特征进行RIO Pooling得到Features</p>
<h3 id="3-LOSS"><a href="#3-LOSS" class="headerlink" title="3.LOSS"></a>3.LOSS</h3><p>使用SoftmaxLoss取代了SVM，SmoothL1Loss取代了回归器，最后两个Loss合并。</p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>虽然已经很厉害了，但是候选框的选取还是慢啊</p>
<p>=========================================</p>
<h1 id="四、Faster-RCNN"><a href="#四、Faster-RCNN" class="headerlink" title="四、Faster-RCNN"></a>四、Faster-RCNN</h1><pre><code>graph LR
image--&gt;CNN
CNN--&gt;Features
Features--&gt;RPN
Features--&gt;Feature
RPN--&gt;Feature
Feature--&gt;RIO_Pooling
RIO_Pooling--&gt;SoftmaxLoss
SoftmaxLoss--&gt;Loss
RIO_Pooling--&gt;SmoothL1Loss
SmoothL1Loss--&gt;Loss
</code></pre><h3 id="改进-2"><a href="#改进-2" class="headerlink" title="改进"></a>改进</h3><p>这个就厉害了，直接把候选框选取用一个网络实现了，而且是在特征提取过以后，想想就快啊。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/10/Conda使用总结/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="田小默">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="田小默的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/05/10/Conda使用总结/" class="post-title-link" itemprop="url">Conda使用总结</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-05-10 11:19:00 / Modified: 11:22:50" itemprop="dateCreated datePublished" datetime="2018-05-10T11:19:00+08:00">2018-05-10</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-创建新的开发环境："><a href="#1-创建新的开发环境：" class="headerlink" title="1 创建新的开发环境："></a>1 创建新的开发环境：</h3><p>创建新开发环境的语法如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create --name &lt;envname&gt; python=&lt;version&gt; &lt;optional dependencies&gt;</span><br></pre></td></tr></table></figure></p>
<p>例如如下命令会在Anaconda安装目录下的envs目录中创建一个名为Python36的新开发环境并且使用的python版本为3.6。</p>
<pre><code>conda create -n Python35 python=3.6
</code></pre><p>若要在当前目录下创建，则使用</p>
<pre><code>conda create -p &lt;envname&gt; python=&lt;version&gt; &lt;optional dependencies&gt;
</code></pre><h3 id="2-激活新的开发环境"><a href="#2-激活新的开发环境" class="headerlink" title="2 激活新的开发环境"></a>2 激活新的开发环境</h3><p>Linux, OS X:</p>
<pre><code>source activate &lt;envname&gt;
</code></pre><p>Windows:</p>
<pre><code>activate &lt;envname&gt;
</code></pre><p>激活了开发环境后可以使用conda或者pip在该开发环境中安装新的包。</p>
<h3 id="3-退出新的开发环境"><a href="#3-退出新的开发环境" class="headerlink" title="3 退出新的开发环境"></a>3 退出新的开发环境</h3><p>Linux, OS X:</p>
<pre><code>source deactivate
</code></pre><p>Windows:</p>
<pre><code>deactivate
</code></pre><h3 id="4-查看目前拥有的开发环境"><a href="#4-查看目前拥有的开发环境" class="headerlink" title="4 查看目前拥有的开发环境"></a>4 查看目前拥有的开发环境</h3><pre><code>conda info --envs
</code></pre><p>或者</p>
<pre><code>conda env list
</code></pre><h3 id="5-复制现有开发环境"><a href="#5-复制现有开发环境" class="headerlink" title="5 复制现有开发环境"></a>5 复制现有开发环境</h3><pre><code>conda create --name &lt;envname&gt; --clone &lt;existing_env&gt;
</code></pre><h3 id="6-删除整个开发环境"><a href="#6-删除整个开发环境" class="headerlink" title="6 删除整个开发环境"></a>6 删除整个开发环境</h3><pre><code>conda env remove --name &lt;envname&gt; --all
</code></pre><h3 id="7-导出和导入开发环境"><a href="#7-导出和导入开发环境" class="headerlink" title="7 导出和导入开发环境"></a>7 导出和导入开发环境</h3><p>导出：</p>
<pre><code>conda env export &gt; environment.yml
</code></pre><p>导入：</p>
<pre><code>conda env create -f environment.yml
</code></pre><p>导出和导入都会自动帮你处理好pip中的依赖。</p>
<h3 id="8-总结"><a href="#8-总结" class="headerlink" title="8 总结"></a>8 总结</h3><p>更多说明请查阅<a href="https://conda.io/docs/user-guide/tasks/manage-environments.html" target="_blank" rel="noopener">官方文档</a>。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="田小默">
            
              <p class="site-author-name" itemprop="name">田小默</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">27</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">19</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/tianxiaomo" title="GitHub &rarr; https://github.com/tianxiaomo" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://weibo.com/tianxiaoxiaomo" title="Weibo &rarr; https://weibo.com/tianxiaoxiaomo" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.zhihu.com/people/tian-mo-98-60" title="Zhihu &rarr; https://www.zhihu.com/people/tian-mo-98-60" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>Zhihu</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">田小默</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v6.6.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.6.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  

  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  











  





  

  

  

  

  
  

  
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

  


  
  

  

  

  

  

  

  
  

  
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

  


</body>
</html>
